@using Neosinerji.BABOnlineTP.Web.Content.Lang
@section HorizontalMenu
{
    <ul class="nav">
        <li class="active">
            <a href="#">@babonline.CommissionRate<span class="selected"></span></a>
        </li>
        <li>
            <span class="hor-menu-search-form-toggler">&nbsp;</span>
            <div class="search-form hidden-phone hidden-tablet">
                <form class="form-search">
                    <div class="input-append">
                        <input type="text" placeholder="@babonline.Search2" class="m-wrap">
                        <button type="button" class="btn"></button>
                    </div>
                </form>
            </div>
        </li>
    </ul>
}
@section PageHeader
{
}
@section PageScripts
{
    <style>
        .editable-input {
            height: 34px !important;
        }

        .collapse {
            display: block !important;
        }
    </style>
    @*<link data-require="bootstrap-css@2.3.2" data-semver="2.3.2" rel="stylesheet" href="@Url.Content("~/Content/js/Angular/MultiSelect/bootstrap-combined.min.css")" />*@
    <link href="@Url.Content("~/Content/Angular/css/bootstrap.min.css")" rel="stylesheet" />
    <link rel="stylesheet" href="@Url.Content("~/Content/Angular/css/style.css")" />
    <link rel="stylesheet" href="@Url.Content("~/Content/Angular/css/xeditable.css")" />
    <script data-require="angular.js@1.1.x" src="@Url.Content("~/Content/Angular/js/angular.min.js")" data-semver="1.1.5"></script>
    <script src="@Url.Content("~/Content/Angular/js/xeditable.js")"></script>
    <script src="@Url.Content("~/Content/Angular/js/multiselect.js")"></script>
    <script src="@Url.Content("~/Content/Angular/pagejs/komisyon.oran.js")"></script>
    <script src="@Url.Content("~/Content/Angular/js/angular.babonline.resource.js")"></script>
    <script src="@Url.Content("~/Content/Angular/js/sweetalert.min.js")"></script>
    <link href="@Url.Content("~/Content/Angular/css/sweetalert.css")" rel="stylesheet" />
}
<div class="row-fluid" ng-app="komisyon.oran" ng-controller="KomisyonOranCtrl">
    <div class="span12">
        <div class="portlet box light-grey" style="margin-top: 24px;">
            <div class="portlet-title">
                <div class="caption">
                    <i class="icon-reorder"></i>
                    <span class="hidden-480" ng-bind="resource('sub_agency_commission_rate')"></span>
                </div>
            </div>
            <div class="portlet-body form form-horizontal">
                @*<form class="form-horizontal" editable-form name="form">*@
                <div class="row-fluid" style="padding-top: 10px;">
                    <div class="span6">
                        <div class="control-group">
                            <label class="control-label" ng-bind="resource('operation')"></label>
                            <div class="controls">
                                <input type="radio" ng-model="selectedIslem" ng-value="islem[0]" ng-click="listemi=true"><label ng-bind="resource('list')"></label>
                                <input type="radio" ng-model="selectedIslem" ng-value="islem[1]" ng-click="listemi=false"><label ng-bind="resource('commission_rate')"></label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row-fluid" style="padding-top: 10px;">
                    <div class="span6">
                        <div class="control-group">
                            <label class="control-label" ng-bind="resource('Resource_Selection')"></label>
                            <div class="controls">
                                <input type="radio" ng-model="selectedkaynakSecim" ng-value="kaynakSecim[0]" ng-click="satisKanaliMi=true"><label ng-bind="resource('sub_agency')"></label>
                                <input type="radio" ng-model="selectedkaynakSecim" ng-value="kaynakSecim[1]" ng-click="satisKanaliMi=false"><label ng-bind="resource('outsource')"></label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row-fluid" ng-show="satisKanaliMi">
                    <div class="span6">
                        <div class="control-group">
                            <label class="control-label" ng-bind="resource('sub_agency')"></label>
                            <div class="controls">
                                <multiselect class="input-xxlarge" multiple="true"
                                             ng-model="selectedTVM"
                                             options="c.Unvani for c in tvmler"
                                             change="selected()"></multiselect>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row-fluid" ng-show="!satisKanaliMi">
                    <div class="span6">
                        <div class="control-group">
                            <label class="control-label" ng-bind="resource('outsource')"></label>
                            <div class="controls">
                                <multiselect class="input-xxlarge" multiple="true"
                                             ng-model="selectedDisKaynak"
                                             options="c.Unvani for c in disKaynaklar"
                                             change="selected()"></multiselect>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row-fluid" ng-show="satisKanaliMi">
                    <div class="span6">
                        <div class="control-group">
                            <label class="control-label" ng-bind="resource('outsource')"></label>
                            <div class="controls">
                                @*      <select name="repeatSelect" ng-model="selectedTaliDisKaynak"  class="input-xxlarge" change="selected()">
                                      <option ng-repeat="option in taliDisKaynaklar" value="{{option.Kodu}}">{{option.Unvani}}</option>
                                    </select>*@
                                <select class="input-xxlarge"
                                        ng-model="selectedTaliDisKaynak"
                                        ng-options="c.Unvani for c in taliDisKaynaklar"
                                        change="selected()">
                                    <option value="">Seçiniz..</option>
                                </select>
                            </div>

                        </div>
                    </div>
                </div>
                <div class="row-fluid">
                    <div class="span6">
                        <div class="control-group">
                            <label class="control-label" ng-bind="resource('branch')"></label>
                            <div class="controls">
                                <multiselect class="input-xlarge" multiple="true"
                                             ng-model="selectedBrans"
                                             options="b.Adi for b in branslar"
                                             change="selected()"></multiselect>
                            </div>
                        </div>
                    </div>
                    <div class="span6">
                    </div>
                </div>
                <div class="row-fluid">
                    <div class="span6">
                        <div class="control-group">
                            <label class="control-label" ng-bind="resource('insurance_company')"></label>
                            <div class="controls">
                                <multiselect class="input-xlarge" multiple="true"
                                             ng-model="selectedSigortaSirketi"
                                             options="s.Adi for s in sigortaSirketleri"
                                             change="selected()"></multiselect>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row-fluid" style="padding-top: 10px;">
                    <div class="span6">
                        <div class="control-group">
                            <label class="control-label" ng-bind="'Kademeli Komisyon'"></label>
                            <div class="controls">
                                <input type="checkbox" ng-model="kademeli">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row-fluid" ng-show="!kademeli">
                    <div class="span6">
                        <div class="control-group">
                            <label class="control-label" ng-bind="resource('validity_start_date')"></label>
                            <div class="controls">
                                <a href="#" editable-date="filtre.baslangicTarihi" ng-bind="filtre.baslangicTarihi|date:'dd/MM/yyyy' || resource('enter_date')" onaftersave="tarihKontrol()"></a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row-fluid" ng-show="!kademeli&&!listemi">
                    <div class="span6">
                        <div class="control-group">
                            <label class="control-label" ng-bind="resource('rate')"></label>
                            <div class="controls">
                                <div class="ng-scope">
                                    <input ng-model="filtre.oran" type="number" ng-pattern="/^[0-9]+(\.[0-9]{1,2})?$/" step="0.01" ng-bind="filtre.oran || '0.01' "></input>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row-fluid" ng-show="kademeli">
                    <div class="span6">
                        <div class="control-group">
                            <label class="control-label" ng-bind="'Geçerli Yıl'"></label>
                            <div class="controls">
                                <a href="#" editable-select="filtre.gecerliYil" e-ng-options="s.value as s.text for s in yillar">{{ showYil() }}</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row-fluid" ng-show="kademeli&&!listemi">
                    <div class="span12">
                        <div class="pagination-centered span3">
                            <label class="control-label" ng-bind="'Kademe Mininum Prim'"></label>
                        </div>
                        <div class="pagination-centered span3">
                            <label class="control-label" ng-bind="'Kademe Maksimum Prim'"></label>
                        </div>
                        <div class="pagination-centered span3">
                            <label class="control-label" ng-bind="'Kademe Oran'"></label>
                        </div>
                        <div class="pagination-centered span3">
                            <label class="control-label" ng-bind="'Kademe Ekle/Çıkar'"></label>
                        </div>
                    </div>
                </div>
                <div class="row-fluid" ng-show="kademeli&&!listemi" ng-repeat="kademe in kademeListesi| orderBy:'Sira'">
                    <div class="span12">
                        <div ng-class="'span3 text-center'"><a editable-number="kademe.MinUretim" e-step="any" e-ng-readonly="true" ng-bind="kademe.MinUretim| number:2 || 'Prim Miktarını Giriniz'"></a></div>
                        <div ng-class="'span3 text-center'"><a editable-number="kademe.MaxUretim" e-step="any" onaftersave="kademeDuzenle()" ng-bind="kademe.MaxUretim|number:2 || 'Prim Miktarını Giriniz'"></a></div>
                        <div ng-class="'span3 text-center'"><a editable-range="kademe.Oran" e-step="1" ng-bind="kademe.Oran || '0'"></a></div>
                        <div ng-class="'span3 text-center'">
                            <a ng-click="kademeEkle(kademe)">
                                <span ng-class="'glyphicon glyphicon-plus'">Ekle</span>
                            </a>
                            <a ng-click="kademeCikar(kademe)" ng-show="kademe.CikarShow">
                                <span ng-class="'glyphicon glyphicon-minus'">Çıkar</span>
                            </a>
                        </div>
                    </div>
                </div>
                <div class="row-fluid" ng-show="satisKanaliMi">
                    <div class="span12">
                        <span style="color:red; font-size:medium;"> DİKKAT! Seçilen satış kanallarınızın dış kaynak(üzerinden iş yapılan acente) üzerinden yaptığı işlerin komisyon oranını tanımlamaktasınız! </span>
                    </div>
                </div>

                <div class="row-fluid">
                    <div class="span6">
                        <div class="control-group">
                            <div class="span12" style="padding-bottom: 20px; display: block;" ng-show="loading">
                                <div style="margin: 20px auto; width: 500px; text-align: center;">
                                    <h4 ng-bind="resource('please_waiting')"></h4>
                                </div>
                                <div style="margin: 20px auto; width: 500px; text-align: center;">
                                    <img src="/Content/img/loading9.gif" width="32" height="32" title="{{resource('pw_detection_rate')}}" alt="{{resource('pw_detection_rate')}}">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="alert" class="alert fade" style="display: none">
                    <button type="button" class="close" id="close-alert">×</button>
                    <strong>@babonline.Warning</strong>  @babonline.Message_Customer_SearchError
                </div>
                <div class="form-actions">
                    <a id="search" class="btn green" data-loading-text="@babonline.Message_Loading" ng-click="postForm()" ng-bind="resource(selectedIslem.adi)"></a>
                </div>
                <div class="row-fluid" style="margin-top: 20px;">
                    <div class="span12">
                        <div id="table-div" style="overflow-x: auto; margin-top: 15px;">
                            <table class="table table-striped table-bordered table-hover dataTable data-table" style="table-layout: inherit" ng-show="!kademeli">
                                <thead>
                                    <tr>
                                        <th style="width: 30%;" ng-bind="resource('sub_agency_title')"></th>
                                        <th style="width: 30%;" ng-bind="resource('outsource')"></th>
                                        <th style="width: 15%;" ng-bind="resource('branch')"></th>
                                        <th style="width: 20%;" ng-bind="resource('insurance_company')"></th>
                                        <th style="width: 15%;" ng-bind="resource('validity_start_date')"></th>
                                        <th style="width: 10%;" ng-bind="resource('rate')"></th>
                                        <th style="width: 10%;" ng-bind="resource('operation')"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="k in komisyonList">
                                        <td ng-bind="k.TaliUnvani"></td>
                                        <td ng-bind="k.TaliDisKaynakUnvani"></td>
                                        <td ng-bind="k.BransAdi"></td>
                                        <td ng-bind="k.SigortaSirketiAdi"></td>
                                        <td><a href="#" editable-date="k.BaslangicTarihi" onaftersave="updateRow(k)" ng-bind="k.BaslangicTarihi|date:'dd/MM/yyyy' || resource('enter_date')"></a></td>
                                        <td> <input ng-model="k.Oran" type="number" aria-label="k.Oran" ng-pattern="/^[0-9]+(\.[0-9]{1,2})?$/" step="0.01" ng-change="updateRow(k)" /></td>
                                        <td><a id="search" class="btn green" ng-show="k.Guncelle" ng-click="postRow(k)" ng-bind="resource('update')"></a></td>
                                    </tr>
                                </tbody>
                                <tfoot>
                                <td colspan="7">
                                    <div class="pagination">
                                        <ul>
                                            <li ng-class="prevPageDisabled()">
                                                <a href ng-click="prevPage()">« Önceki</a>
                                            </li>
                                            <li ng-repeat="n in range()" ng-class="{active: n == currentPage}" ng-click="setPage(n)">
                                                <a href="">{{n+1}}</a>
                                            </li>
                                            <li ng-class="nextPageDisabled()">
                                                <a href ng-click="nextPage()">Sonraki »</a>
                                            </li>
                                        </ul>
                                        <div style="text-align: right" ng-show="total>0">Toplam Kayıt:{{total}} Gösterilen Kayıtlar:{{minKayit}}-{{maxKayit}} Sayfa:{{currentPage+1}}/{{pageCount()}}</div>
                                    </div>
                                </td>
                                </tfoot>
                            </table>
                            <table class="table table-striped table-bordered table-hover dataTable data-table" style="table-layout: inherit" ng-show="kademeli">
                                <thead>
                                    <tr>
                                        <th style="width: 30%;" ng-bind="resource('sub_agency_title')"></th>
                                        <th style="width: 30%;" ng-bind="resource('outsource')"></th>
                                        <th style="width: 15%;" ng-bind="resource('branch')"></th>
                                        <th style="width: 20%;" ng-bind="resource('insurance_company')"></th>
                                        <th style="width: 20%;" ng-bind="'Geçerli Yıl'"></th>
                                        <th style="width: 10%;" ng-bind="resource('operation')"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="k in komisyonKademeList">
                                        <td colspan="6">
                                            <table class="table table-striped table-bordered table-hover dataTable data-table" style="table-layout: inherit">
                                                <tr>
                                                    <td title="Detayları Görmek için Lütfen Tıklayınız" ; style=" cursor: pointer; width: 30%;" ng-bind="k.TaliUnvani" ng-click="kademeGoster(k)"></td>
                                                    <td title="Detayları Görmek için Lütfen Tıklayınız" ; style=" cursor: pointer; width: 30%;" ng-bind="k.TaliDisKaynakUnvani" ng-click="kademeGoster(k)"></td>
                                                    <td title="Detayları Görmek için Lütfen Tıklayınız" style=" cursor: pointer; width: 15%;" ng-bind="k.BransAdi" ng-click="kademeGoster(k)"></td>
                                                    <td title="Detayları Görmek için Lütfen Tıklayınız" style=" cursor: pointer; width: 20%;" ng-bind="k.SigortaSirketiAdi" ng-click="kademeGoster(k)"></td>
                                                    <td style="width: 20%;"><a href="#" editable-select="k.GecerliYil" e-ng-options="s.value as s.text for s in yillar" onaftersave="k.Guncelle=true">{{ showListeYil(k) }}</a></td>
                                                    <td style="width: 10%;"><a id="search" class="btn green" ng-show="k.Guncelle" ng-click="postRow(k)" ng-bind="resource('update')"></a></td>
                                                </tr>
                                                <tr ng-show="k.kademeShow">
                                                    <td colspan="6">
                                                        <div class="row-fluid">
                                                            <div class="span12">
                                                                <div class="pagination-centered span3">
                                                                    <label class="control-label" ng-bind="'Kademe Mininum Prim'"></label>
                                                                </div>
                                                                <div class="pagination-centered span3">
                                                                    <label class="control-label" ng-bind="'Kademe Maksimum Prim'"></label>
                                                                </div>
                                                                <div class="pagination-centered span3">
                                                                    <label class="control-label" ng-bind="'Kademe Oran'"></label>
                                                                </div>
                                                                <div class="pagination-centered span3">
                                                                    <label class="control-label" ng-bind="'Kademe Ekle/Çıkar'"></label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row-fluid" ng-repeat="kademe in k.KademeListesi| orderBy:'Sira'">
                                                            <div class="span12">
                                                                <div ng-class="'span3 text-center'"><a editable-number="kademe.MinUretim" e-step="any" e-ng-readonly="true" ng-bind="kademe.MinUretim| number:2 || 'Prim Miktarını Giriniz'"></a></div>
                                                                <div ng-class="'span3 text-center'"><a editable-number="kademe.MaxUretim" e-step="any" onaftersave="listeKademeDuzenle(k.KademeListesi);k.Guncelle=true;" ng-bind="kademe.MaxUretim|number:2 || 'Prim Miktarını Giriniz'"></a></div>
                                                                <div ng-class="'span3 text-center'"><a editable-range="kademe.Oran" e-step="1" ng-bind="kademe.Oran || '0'" onaftersave="k.Guncelle=true"></a></div>
                                                                <div ng-class="'span3 text-center'">
                                                                    <a ng-click="listeKademeEkle(k.KademeListesi,kademe);k.Guncelle=true;">
                                                                        <span ng-class="'glyphicon glyphicon-plus'">Ekle</span>
                                                                    </a>
                                                                    <a ng-click="listeKademeCikar(k.KademeListesi,kademe);k.Guncelle=true;" ng-show="kademe.CikarShow">
                                                                        <span ng-class="'glyphicon glyphicon-minus'">Çıkar</span>
                                                                    </a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>
                                </tbody>
                                <tfoot>
                                <td colspan="5">
                                    <div class="pagination">
                                        <ul>
                                            <li ng-class="prevPageDisabled()">
                                                <a href ng-click="prevPage()">« Önceki</a>
                                            </li>
                                            <li ng-repeat="n in range()" ng-class="{active: n == currentPage}" ng-click="setPage(n)">
                                                <a href="">{{n+1}}</a>
                                            </li>
                                            <li ng-class="nextPageDisabled()">
                                                <a href ng-click="nextPage()">Sonraki »</a>
                                            </li>
                                        </ul>
                                        <div style="text-align: right" ng-show="total>0">Toplam Kayıt:{{total}} Gösterilen Kayıtlar:{{minKayit}}-{{maxKayit}} Sayfa:{{currentPage+1}}/{{pageCount()}}</div>
                                    </div>
                                </td>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
                @*</form>*@
            </div>
        </div>
    </div>
</div>
