@using Neosinerji.BABOnlineTP.Web.Content.Lang
@using Neosinerji.BABOnlineTP.Business.Common
@using Neosinerji.BABOnlineTP.Database.Models
@using Neosinerji.BABOnlineTP.Web.Areas.Muhasebe.Models
@model TopluPoliceTahsilatOdemeModel
@section HorizontalMenu
{
    <ul class="nav">
        <li class="active">
            <a href="javascript:;">Toplu Poliçe Ödeme<span class="selected"></span></a>
        </li>
        <li>
            <span class="hor-menu-search-form-toggler">&nbsp;</span>
            <div class="search-form hidden-phone hidden-tablet">
                <form class="form-search">
                    <div class="input-append">
                        <input type="text" placeholder="@babonline.Search" class="m-wrap">
                        <button type="button" class="btn"></button>
                    </div>
                </form>
            </div>
        </li>
    </ul>
}

@section PageHeader
{
    <style type="text/css">
        .baslikRow:hover {
            background-color: #ffc299 !important;
        }

        .baslikRow {
            background-color: #ffc299 !important;
        }
    </style>
}
@section PageScripts
{

    @Scripts.Render("~/bundles/switch")
    <link href="~/Content/css/bootstrapSwitch.min.css" rel="stylesheet" />
    <link href="~/Content/Angular/css/sweetalert.css" rel="stylesheet" />
    <link href="~/Content/css/bootstap-multiselect.css" rel="stylesheet" />
    <script src="~/Content/Angular/js/sweetalert.min.js"></script>
    <script src="~/Content/js/moment.js"></script>
    <script src="~/Content/js/mask.js"></script>
    <script src="~/Content/js/customDataTable.js" type="text/javascript"></script>

    <script>


        //createTable(".data-table", [16,17,18,19,20,21,22,23]);
        //createTable(".data-table", [], []);


        $(document).ready(function () {



            $("#BitisGunAy").mask("99.99");
            $("#BaslangicGunAy").mask("99.99");
            $("#BitisGunAy1").mask("99.99");
            $("#BaslangicGunAy1").mask("99.99");
            var tcknvknText = $('#texttcvkn').val();
            if (tcknvknText != "" && tcknvknText != null) {
                $("#radiotcvkn").trigger("click");
                $('#texttcvkn').removeAttr("disabled");
            }
            var musteriGrupKoduText = $('#textMust').val();
            if (musteriGrupKoduText != "" && musteriGrupKoduText != null) {
                $("#radioMust").trigger("click");
                $('#textMust').removeAttr("disabled");
                $('#ikiTarihAraligi').show();
            }

            var tvmKoduText = $('textTvm').val();
            if (tvmKoduText != "" && tvmKoduText != null) {
                $("#radioTvm").trigger("click");
                $('#textTvm').removeAttr("disabled");
                $('#ikiTarihAraligi1').show();
            }

            var unvanAdiText = $('.textunvan').val();
            var unvanSoyadiText = $('#textunvansoyad').val();
            var firmaAdiText = $('.textunvanfirma').val();
            if (((unvanAdiText != "" && unvanAdiText != null) && (unvanSoyadiText != "" && unvanSoyadiText != null)) || (firmaAdiText != "" && firmaAdiText != null)) {
                $("#radiounvan").trigger("click");
                $('.textunvan').removeAttr("disabled");
                $('#textunvansoyad').removeAttr("disabled");
                $('.textunvanfirma').removeAttr("disabled");
            }

            $("#OdenenTutar").keypress(function (event) {
                return isNumber(event, this);
            });
            function isNumber(evt, element) {
                var charCode = (evt.which) ? evt.which : event.keyCode
                if ((charCode == 44) || (charCode >= 48 && charCode <= 57) || (charCode == 08)) {

                    if (($(element).val().indexOf(',') != -1) && charCode == 44) {
                        return false;
                    }
                    return true;
                }
                return false;
            }
            $("#OdenenTutar").keyup(function () {

                var taksitTutari = parseFloat(String($("#_TaksitToplamlari").val()).replace(",", "."));
                var odenenTutar = parseFloat(String($("#OdenenTutar").val()).replace(",", "."));
                var kalan = odenenTutar - taksitTutari;
                if (kalan >= 0) {
                    $("#_Kalan").val(kalan.toFixed(2).replace(".", ","));
                    $("#_Kalan").attr("kalanTutar", (kalan.toFixed(2).replace(".", ",")));
                    $("#_Kalan").css('color', 'green');
                }
                else if (kalan < 0) {
                    kalan = kalan * -1;
                    $("#_Kalan").val(kalan.toFixed(2).replace(".", ","));
                    kalan = kalan * -1;
                    $("#_Kalan").attr("kalanTutar", (kalan.toFixed(2).replace(".", ",")));
                    $("#_Kalan").css('color', 'red');
                }
            });
            $("#OdenenTutar").change(function () {
                var toplamOdenen = 0;
                var kismiHaricOdenen = 0;
                parseFloat(toplamOdenen).toFixed(2);
                parseFloat(kismiHaricOdenen).toFixed(2);
                var kismiId = "";
                $('input[class=tahsilatListesi]').each(function (index, element) {
                    if ($(this).is(':checked')) {
                        toplamOdenen = toplamOdenen + parseFloat(String($(this).attr("odenecekTutar")));
                        if ((parseFloat(String($(this).attr("odenecekTutar")).replace(",", "."))) != (parseFloat(String($(this).attr("taksitTutari")).replace(",", ".")))) {
                            kismiId = $(this).attr("id");
                        }
                        else {
                            kismiHaricOdenen = kismiHaricOdenen + parseFloat(String($(this).attr("odenecekTutar")));
                        }
                    }
                });
                var taksitTutari = parseFloat(String($("#_TaksitToplamlari").val()).replace(",", "."));
                var odenenTutar = parseFloat(String($("#OdenenTutar").val()).replace(",", "."));
                kismiHaricOdenen = parseFloat(kismiHaricOdenen.toFixed(2));
                var policeNumarasi = $("#" + kismiId).attr("policenumarasi");
                if (kismiId != "") {
                    if ((odenenTutar > toplamOdenen)) {
                        var taksitTutariKismi = parseFloat($("#" + kismiId).attr("taksitTutari").replace(",", "."));
                        if ((kismiHaricOdenen + taksitTutariKismi) <= odenenTutar) {
                            $("#" + kismiId).attr("odenecekTutar", taksitTutariKismi.toFixed(2));
                            swal("Bilgi ", "Poliçe Numarası-Taksit Numarası = " + policeNumarasi + " Olan Taksit, Taksit Miktarı Kadar(" + taksitTutariKismi.toFixed(2).replace(".", ",") + "TL) Ödenecektir.", "info");
                            return false;
                        }
                        else if ((kismiHaricOdenen + taksitTutariKismi) > odenenTutar) {
                            $("#" + kismiId).attr("odenecekTutar", (odenenTutar - kismiHaricOdenen).toFixed(2));
                            swal("Bilgi ", "Poliçe Numarası-Taksit Numarası = " + policeNumarasi + " Olan Taksit Kısmi(" + (odenenTutar - kismiHaricOdenen).toFixed(2).replace(".", ",") + "TL) Ödenecektir.", "info");
                            return false;
                        }
                    }
                    if ((odenenTutar <= toplamOdenen) && (odenenTutar >= (kismiHaricOdenen + 1))) {
                        $("#" + kismiId).attr("odenecekTutar", (odenenTutar - kismiHaricOdenen).toFixed(2));
                        swal("Bilgi ", "Poliçe Numarası-Taksit Numarası = " + policeNumarasi + " Olan Taksit Kısmi(" + (odenenTutar - kismiHaricOdenen).toFixed(2).replace(".", ",") + "TL) Ödenecektir.", "info");
                        return false;
                    }
                    if (odenenTutar < (kismiHaricOdenen + 1)) {
                        $("#OdenenTutar").val(String((kismiHaricOdenen + 1).toFixed(2)).replace(".", ","));
                        var bir = 1;
                        $("#" + kismiId).attr("odenecekTutar", bir.toFixed(2));
                        var kalan = (kismiHaricOdenen + 1) - taksitTutari;
                        if (kalan >= 0) {
                            $("#_Kalan").val(kalan.toFixed(2).replace(".", ","));
                            $("#_Kalan").attr("kalanTutar", (kalan.toFixed(2).replace(".", ",")));
                            $("#_Kalan").css('color', 'green');
                        }
                        else if (kalan < 0) {
                            kalan = kalan * -1;
                            $("#_Kalan").val(kalan.toFixed(2).replace(".", ","));
                            kalan = kalan * -1;
                            $("#_Kalan").attr("kalanTutar", (kalan.toFixed(2).replace(".", ",")));
                            $("#_Kalan").css('color', 'red');
                        }
                        swal("HATA ", "Taksitlerinizde Bir Tane Kısmı Ödeme Yaptığınız İçin Ödeme Tutarınız En Az" + (kismiHaricOdenen + 1).toFixed(2).replace(".", ",") + " Olmalıdır. (" + policeNumarasi + ")\nBu Şekilde Ödeme Yaparsanız Police No-Taksit No = " + policeNumarasi + " Olan Taksidinize 1,00TL Ödenecektir.)", "warning");
                        return false;
                    }
                }
                if (kismiHaricOdenen > odenenTutar.toFixed(2)) {
                    $("#OdenenTutar").val(String((kismiHaricOdenen)).replace(".", ","));
                    if ((kismiHaricOdenen - taksitTutari) >= 0) {
                        $("#_Kalan").val(String(kismiHaricOdenen - taksitTutari).replace(".", ","));
                        $("#_Kalan").attr("kalanTutar", String(kismiHaricOdenen - taksitTutari).replace(".", ","));
                        $("#_Kalan").css('color', 'green');
                    }
                    else if ((kismiHaricOdenen - taksitTutari) < 0) {
                        $("#_Kalan").val(String((kismiHaricOdenen - taksitTutari) * -1).replace(".", ","));
                        $("#_Kalan").attr("kalanTutar", String(kismiHaricOdenen - taksitTutari).replace(".", ","));
                        $("#_Kalan").css('color', 'red');
                    }
                    swal("HATA ", "Ödenen Tutar En az " + String((kismiHaricOdenen)).replace(".", ",") + " Olmalıdır.", "warning");
                    return false;
                }
            });
            $('.tahsilatListesiTopluSecim').click(function () {
                if ($(this).is(':checked')) {
                    var policeId = $(this).attr("policeId");
                    var policeNumarasi = $(this).attr("policenumarasi");
                    var kalan = parseFloat(String($("#_Kalan").attr("kalanTutar")).replace(",", "."));
                    if (kalan > 0) {
                        $('input[taksitPoliceId=' + policeId + ']').each(function (index, element) {
                            if (!$(this).is(':checked')) {
                                var taksitTutari = parseFloat(String($(this).attr("taksitTutari")).replace(",", "."));
                                var suanki = parseFloat(String($("#_TaksitToplamlari").val()).replace(",", "."));
                                var odenenTutar = parseFloat(String($("#OdenenTutar").val()).replace(",", "."));
                                kalan = parseFloat(String($("#_Kalan").attr("kalanTutar")).replace(",", "."));
                                if (kalan > 0) {
                                    if (kalan - taksitTutari >= 0) {
                                        $(this).prop("checked", true);
                                        $(this).attr("odenecekTutar", taksitTutari.toFixed(2));
                                        $("#_TaksitToplamlari").val((suanki + taksitTutari).toFixed(2).replace(".", ","));
                                        if ((kalan - taksitTutari) >= 0) {
                                            $("#_Kalan").val((kalan - taksitTutari).toFixed(2).replace(".", ","));
                                            $("#_Kalan").attr("kalanTutar", (kalan - taksitTutari).toFixed(2).replace(".", ","));
                                            $("#_Kalan").css('color', 'green');
                                        }
                                        else if ((kalan - taksitTutari) < 0) {
                                            $("#_Kalan").val(((kalan - taksitTutari) * -1).toFixed(2).replace(".", ","));
                                            $("#_Kalan").attr("kalanTutar", (kalan - taksitTutari).toFixed(2).replace(".", ","));
                                            $("#_Kalan").css('color', 'red');
                                        }
                                    }
                                    else if (kalan - taksitTutari < 0) {
                                        swal("Bilgi ", "Poliçe Numarası " + policeNumarasi + " Olan " + $(this).attr("taksitNo") + ". Taksit Kısmi(" + kalan + "TL) Ödenecektir.", "info");
                                        $(this).prop("checked", true);
                                        $(this).attr("odenecekTutar", kalan.toFixed(2));
                                        $("#_TaksitToplamlari").val((suanki + taksitTutari).toFixed(2).replace(".", ",")); if ((kalan - taksitTutari) >= 0) {
                                            $("#_Kalan").val((kalan - taksitTutari).toFixed(2).replace(".", ","));
                                            $("#_Kalan").attr("kalanTutar", (kalan - taksitTutari).toFixed(2).replace(".", ","));
                                            $("#_Kalan").css('color', 'green');
                                        }
                                        else if ((kalan - taksitTutari) < 0) {
                                            $("#_Kalan").val(((kalan - taksitTutari) * -1).toFixed(2).replace(".", ","));
                                            $("#_Kalan").attr("kalanTutar", (kalan - taksitTutari).toFixed(2).replace(".", ","));
                                            $("#_Kalan").css('color', 'red');
                                        }
                                    }
                                }
                                else if (kalan <= 0) {
                                    $(this).prop("checked", false);
                                    return false;
                                }

                            }
                        });
                    }
                    else if (kalan <= 0) {
                        swal("Hata ", "Ödemeniz Yetersiz.", "warning")
                        $(this).prop("checked", false);
                        return false;
                    }
                }
                else {
                    var odenenTutar = parseFloat(String($("#OdenenTutar").val()).replace(",", "."));
                    var policeId = $(this).attr("policeId");
                    var toplamOdenecekTutar = 0;
                    $('input[taksitPoliceId=' + policeId + ']').each(function (index, element) {
                        if ($(this).is(':checked')) {
                            $(this).prop("checked", false);
                            var taksitTutari = parseFloat(String($(this).attr("taksitTutari")).replace(",", "."));
                            var suanki = parseFloat(String($("#_TaksitToplamlari").val()).replace(",", "."));
                            var odenenTutar = parseFloat(String($("#OdenenTutar").val()).replace(",", "."));
                            var kalan = parseFloat(String($("#_Kalan").attr("kalanTutar")).replace(",", "."));
                            toplamOdenecekTutar = toplamOdenecekTutar + parseFloat(String($(this).attr("odenecektutar")).replace(",", "."));
                            $("#_TaksitToplamlari").val((suanki - taksitTutari).toFixed(2).replace(".", ","));
                            if ((kalan + taksitTutari) >= 0) {
                                $("#_Kalan").val((kalan + taksitTutari).toFixed(2).replace(".", ","));
                                $("#_Kalan").attr("kalanTutar", (kalan + taksitTutari).toFixed(2).replace(".", ","));
                                $("#_Kalan").css('color', 'green');
                            }
                            else if ((kalan + taksitTutari) < 0) {
                                $("#_Kalan").val(((kalan + taksitTutari) * -1).toFixed(2).replace(".", ","));
                                $("#_Kalan").attr("kalanTutar", (kalan + taksitTutari).toFixed(2).replace(".", ","));
                                $("#_Kalan").css('color', 'red');
                            }
                        }
                    });
                    var kismiId = "";
                    var kismiTaksitNo = "";
                    var kismiTaksitTutari = "";
                    $('input[class=tahsilatListesi]').each(function (index, element) {
                        if ($(this).is(':checked')) {
                            if ((parseFloat(String($(this).attr("odenecekTutar")).replace(",", "."))) != (parseFloat(String($(this).attr("taksitTutari")).replace(",", ".")))) {
                                kismiId = $(this).attr("id");
                                kismiTaksitNo = $(this).attr("taksitno");
                                kismiTaksitTutari = parseFloat(String($(this).attr("taksittutari")).replace(",", "."));
                            }
                        }
                    });
                    if (kismiId != "" && kismiId != null) {
                        var kismiOdenecekTutari = parseFloat($("#" + kismiId).attr("odenecektutar").replace(",", "."));
                        var kismiPoliceNo = $("#" + kismiId).attr("policeNumarasi");
                        if (kismiTaksitTutari > (kismiOdenecekTutari + toplamOdenecekTutar).toFixed(2)) {
                            $("#" + kismiId).attr("odenecektutar", (kismiOdenecekTutari + toplamOdenecekTutar).toFixed(2).replace(".", ","));
                            swal("Bilgi ", "Poliçe Numarası " + kismiPoliceNo + " Olan " + kismiTaksitNo + ". Taksit Kısmi(" + (kismiOdenecekTutari + toplamOdenecekTutar).toFixed(2).replace(".", ",") + "TL) Ödenecektir.", "info");
                        }
                        else if (kismiTaksitTutari <= (kismiOdenecekTutari + toplamOdenecekTutar).toFixed(2)) {
                            $("#" + kismiId).attr("odenecektutar", (kismiTaksitTutari).toFixed(2).replace(".", ","));
                            swal("Bilgi ", "Poliçe Numarası " + kismiPoliceNo + " Olan " + kismiTaksitNo + ". Taksit, Taksit Tutari Kadar(" + (kismiTaksitTutari).toFixed(2).replace(".", ",") + "TL) Ödenecektir.", "info");
                        }
                    }
                }
            });
            $('.tahsilatListesi').click(function () {
                if (!($(this).is(':checked'))) {
                    var policeId = $(this).attr("taksitPoliceId");
                    $('input[policeId^=' + policeId + ']').prop("checked", false);
                    var taksitTutari = parseFloat(String($(this).attr("taksitTutari")).replace(",", "."));
                    var odenecekTutar = parseFloat(String($(this).attr("odenecektutar")).replace(",", "."));
                    var suanki = parseFloat(String($("#_TaksitToplamlari").val()).replace(",", "."));
                    var odenenTutar = parseFloat(String($("#OdenenTutar").val()).replace(",", "."));
                    var kalan = parseFloat(String($("#_Kalan").attr("kalanTutar")).replace(",", "."));
                    var kismiId = "";
                    var kismiTaksitNo = "";
                    var kismiTaksitTutari = "";
                    $('input[class=tahsilatListesi]').each(function (index, element) {
                        if ($(this).is(':checked')) {
                            if ((parseFloat(String($(this).attr("odenecekTutar")).replace(",", "."))) != (parseFloat(String($(this).attr("taksitTutari")).replace(",", ".")))) {
                                kismiId = $(this).attr("id");
                                kismiTaksitNo = $(this).attr("taksitno");
                                kismiTaksitTutari = parseFloat(String($(this).attr("taksittutari")).replace(",", "."));
                            }
                        }
                    });
                    if (kismiId != "" && kismiId != null) {
                        var kismiOdenecekTutari = parseFloat($("#" + kismiId).attr("odenecektutar").replace(",", "."));
                        var kismiPoliceNo = $("#" + kismiId).attr("policeNumarasi");
                        if (kismiTaksitTutari > (kismiOdenecekTutari + odenecekTutar).toFixed(2)) {
                            $("#" + kismiId).attr("odenecektutar", (kismiOdenecekTutari + odenecekTutar).toFixed(2).replace(".", ","));
                            swal("Bilgi ", "Poliçe Numarası " + kismiPoliceNo + " Olan " + kismiTaksitNo + ". Taksit Kısmi(" + (kismiOdenecekTutari + odenecekTutar).toFixed(2).replace(".", ",") + "TL) Ödenecektir.", "info");
                        }
                        else if (kismiTaksitTutari <= (kismiOdenecekTutari + odenecekTutar).toFixed(2)) {
                            $("#" + kismiId).attr("odenecektutar", (kismiTaksitTutari).toFixed(2).replace(".", ","));
                            swal("Bilgi ", "Poliçe Numarası " + kismiPoliceNo + " Olan " + kismiTaksitNo + ". Taksit, Taksit Tutari Kadar(" + (kismiTaksitTutari).toFixed(2).replace(".", ",") + "TL) Ödenecektir.", "info");
                        }
                    }
                    $("#_TaksitToplamlari").val((suanki - taksitTutari).toFixed(2).replace(".", ","));
                    if (((kalan + taksitTutari) >= 0)) {
                        $("#_Kalan").val((kalan + taksitTutari).toFixed(2).replace(".", ","));
                        $("#_Kalan").attr("kalanTutar", (kalan + taksitTutari).toFixed(2).replace(".", ","));
                        $("#_Kalan").css('color', 'green');
                    }
                    else if (((kalan + taksitTutari) < 0)) {
                        $("#_Kalan").val(((kalan + taksitTutari) * -1).toFixed(2).replace(".", ","));
                        $("#_Kalan").attr("kalanTutar", (kalan + taksitTutari).toFixed(2).replace(".", ","));
                        $("#_Kalan").css('color', 'red');
                    }
                }
                else {

                    var taksitTutari = parseFloat(String($(this).attr("taksitTutari")).replace(",", "."));
                    var suanki = parseFloat(String($("#_TaksitToplamlari").val()).replace(",", "."));
                    var odenenTutar = parseFloat(String($("#OdenenTutar").val()).replace(",", "."));
                    var kalan = parseFloat(String($("#_Kalan").attr("kalanTutar")).replace(",", "."));
                    if (kalan > 0) {
                        if (kalan - taksitTutari >= 0) {
                            $("#_TaksitToplamlari").val((suanki + taksitTutari).toFixed(2).replace(".", ","));
                            if ((kalan - taksitTutari) >= 0) {
                                $("#_Kalan").val((kalan - taksitTutari).toFixed(2).replace(".", ","));
                                $("#_Kalan").attr("kalanTutar", (kalan - taksitTutari).toFixed(2).replace(".", ","));
                                $("#_Kalan").css('color', 'green');
                            }
                            else if ((kalan - taksitTutari) < 0) {
                                $("#_Kalan").val(((kalan - taksitTutari) * -1).toFixed(2).replace(".", ","));
                                $("#_Kalan").attr("kalanTutar", (kalan - taksitTutari).toFixed(2).replace(".", ","));
                                $("#_Kalan").css('color', 'red');
                            }
                            var policeId = $(this).attr("taksitPoliceId");
                            $(this).attr("odenecekTutar", (taksitTutari).toFixed(2));
                            var hepsiSeçiliMi = true;
                            $('input[taksitPoliceId=' + policeId + ']').each(function (index, element) {
                                var taksitNo = $(this).attr("taksitno");
                                hepsiSeçiliMi = hepsiSeçiliMi * $("#" + policeId + "-" + taksitNo).is(':checked');
                            });
                            if (hepsiSeçiliMi) {
                                $('input[policeId^=' + policeId + ']').prop("checked", true);
                            }
                        }
                        else if (kalan - taksitTutari < 0) {
                            var policeId = $(this).attr("taksitPoliceId");
                            var policeNumarasi = $(this).attr("policenumarasi");
                            swal("Bilgi ", "Poliçe Numarası " + policeNumarasi + " Olan " + $(this).attr("taksitNo") + ". Taksit Kısmi(" + kalan + "TL) Ödenecektir.", "info");
                            $("#_TaksitToplamlari").val((suanki + taksitTutari).toFixed(2).replace(".", ","));
                            if ((kalan - taksitTutari) >= 0) {
                                $("#_Kalan").val((kalan - taksitTutari).toFixed(2).replace(".", ","));
                                $("#_Kalan").attr("kalanTutar", (kalan - taksitTutari).toFixed(2).replace(".", ","));
                                $("#_Kalan").css('color', 'green');
                            }
                            else if ((kalan - taksitTutari) < 0) {
                                $("#_Kalan").val(((kalan - taksitTutari) * -1).toFixed(2).replace(".", ","));
                                $("#_Kalan").attr("kalanTutar", (kalan - taksitTutari).toFixed(2).replace(".", ","));
                                $("#_Kalan").css('color', 'red');
                            }
                            $(this).attr("odenecekTutar", kalan.toFixed(2));
                            var hepsiSeçiliMi = true;
                            $('input[taksitPoliceId=' + policeId + ']').each(function (index, element) {
                                var taksitNo = $(this).attr("taksitno");
                                hepsiSeçiliMi = hepsiSeçiliMi * $("#" + policeId + "-" + taksitNo).is(':checked');
                            });
                            if (hepsiSeçiliMi) {
                                $('input[policeId^=' + policeId + ']').prop("checked", true);
                            }
                        }

                    }
                    else if (kalan <= 0) {
                        swal("Hata ", "Ödemeniz Yetersiz.", "warning")
                        $(this).prop("checked", false);
                        return false;
                    }

                }
            });

            $("[rel=tooltip]").tooltip();
            //Tvm listesini Dolduruyor....
            var tvm = $("#TVMKodu").tvmfinder();
            // tvm.enable();



            $('#radioMust').click(function () {
                $('#ikiTarihAraligi').show();
                $('#ikiTarihAraligi1').hide();
                tvm.disable();

                $('#TVMKodu').val("0");

                $('#textMust').removeAttr("disabled");
                $('#texttcvkn').attr("disabled", "disabled");
                $('#texttcvkn').val("");
                $('#textTvm').attr("disabled", "disabled");
                $('#tvm').attr("disabled", "disabled");
                $('#textTvm').val("");
                $('#TVMKodu').attr("disabled", "disabled");
                $('#BaslangicGunAy1').val("");
                $('#BitisGunAy1').val("");
                $('.textunvan').attr("disabled", "disabled");
                $('.textunvan').val("");
                $('#textunvansoyad').attr("disabled", "disabled");
                $('#textunvansoyad').val("");
                $('.textunvanfirma').attr("disabled", "disabled");
                $('.textunvanfirma').val("");

            });

            $('#radioTvm').click(function () {


                $('#ikiTarihAraligi1').show();
                $('#ikiTarihAraligi').hide();
                $('#textTvm').removeAttr("disabled");
                $('#tvm').removeAttr("disabled");
                $('#TVMKodu').removeAttr("disabled");
                tvm.enable();
                $('#BaslangicGunAy').val("");
                $('#BitisGunAy').val("");
                $('#texttcvkn').attr("disabled", "disabled");
                $('#texttcvkn').val("");
                $('#textMust').attr("disabled", "disabled");
                $('#textMust').val("");
                $('.textunvan').attr("disabled", "disabled");
                $('.textunvan').val("");
                $('#textunvansoyad').attr("disabled", "disabled");
                $('#textunvansoyad').val("");
                $('.textunvanfirma').attr("disabled", "disabled");
                $('.textunvanfirma').val("");

            });

            $('#radiotcvkn').click(function () {
                $('#ikiTarihAraligi').hide();
                $('#ikiTarihAraligi1').hide();
                $('#SigortaEttirenToplamSayisi').hide();
                $('#SigortaEttiren').hide();
                tvm.disable();

                $('#TVMKodu').val("0");
                $('#SigortaEttiren').removeAttr("required");
                $('#texttcvkn').removeAttr("disabled");
                $('#textTvm').attr("disabled", "disabled");
                $('#textTvm').val("");
                $('#TVMKodu').attr("disabled", "disabled");
                $('#textMust').attr("disabled", "disabled");
                $('#textMust').val("");
                $('.textunvan').attr("disabled", "disabled");
                $('.textunvan').val("");
                $('#textunvansoyad').attr("disabled", "disabled");
                $('#textunvansoyad').val("");
                $('.textunvanfirma').attr("disabled", "disabled");
                $('.textunvanfirma').val("");

            });
            $('#radiounvan').click(function () {
                $('#ikiTarihAraligi').hide();
                $('#ikiTarihAraligi1').hide();
                $('#SigortaEttirenToplamSayisi').hide();
                $('#SigortaEttiren').hide();
                $('#SigortaEttiren').removeAttr("required");
                $('.textunvan').removeAttr("disabled");
                $('#textunvansoyad').removeAttr("disabled");
                $('.textunvanfirma').removeAttr("disabled");
                $('#textTvm').attr("disabled", "disabled");
                $('#tvm').attr("disabled", "disabled");
                $('#textTvm').val("");
                tvm.disable();

                $('#TVMKodu').val("0");
                $('#TVMKodu').attr("disabled", "disabled");
                $('#texttcvkn').attr("disabled", "disabled");
                $('#texttcvkn').val("");
                $('#textMust').attr("disabled", "disabled");
                $('#textMust').val("");
            });

        });
        //0 şahıs,1 firma
        $(document).ready(function () {
            var islemTip = $('input[name="Durum"]:checked').val();
            if (islemTip == 0) {
                $(".firma").hide();
                $(".sahis").show();
                $("#textunvansoyad").removeClass("ignore");
            }
            else if (islemTip == 1) {
                $(".firma").show();
                $(".sahis").hide();
                $("#textunvansoyad").addClass("ignore");

            }
            $('input[name="Durum"]').change(function () {
                var islemTip = $(this).val();
                if (islemTip == 0) {
                    $(".firma").hide();
                    $(".sahis").show();

                    $("#textunvansoyad").removeClass("ignore");
                }
                else if (islemTip == 1) {
                    $(".firma").show();
                    $(".sahis").hide();
                    $("#textunvansoyad").addClass("ignore");
                }
            });
            $("#searchl").click(function () {
                var bitisGun = String($("#BitisGunAy").val()).substring(0, 2);
                var bitisAy = String($("#BitisGunAy").val()).substring(3, 6);
                var baslangıcGun = String($("#BaslangicGunAy").val()).substring(0, 2);
                var baslangicAy = String($("#BaslangicGunAy").val()).substring(3, 6);
                var bitisT = ($("#Donem").val().substring(0, 4) + "-" + bitisAy + "-" + bitisGun).toString();
                var baslamaT = ($("#Donem").val().substring(0, 4) + "-" + baslangicAy + "-" + baslangıcGun).toString();
                if (!validDate(bitisT) || !validDate(baslamaT)) {
                    swal("Uyarı!", "İki Tarih Aralığını Gün.Ay Şeklinde yazınız.\nÖrnek: 31.12");
                    return false;
                }

            });
            $("#search2").click(function () {
                var bitisGun1 = String($("#BitisGunAy1").val()).substring(0, 2);
                var bitisAy1 = String($("#BitisGunAy1").val()).substring(3, 6);
                var baslangıcGun1 = String($("#BaslangicGunAy1").val()).substring(0, 2);
                var baslangicAy1 = String($("#BaslangicGunAy1").val()).substring(3, 6);
                var bitisT1 = ($("#Donem").val().substring(0, 4) + "-" + bitisAy + "-" + bitisGun1).toString();
                var baslamaT1 = ($("#Donem").val().substring(0, 4) + "-" + baslangicAy + "-" + baslangıcGun1).toString();
                if (!validDate(bitisT1) || !validDate(baslamaT1)) {
                    swal("Uyarı!", "İki Tarih Aralığını Gün.Ay Şeklinde yazınız.\nÖrnek: 31.12");
                    return false;
                }
            });
            var validDate = function (strDate) {
                var formats = ["YYYY-M-D", "YYYY-MM-DD"];
                var valid = moment(strDate, formats).isValid();
                return valid;
            };
            $("#TopluPoliceTahsilatOdemeYap").click(function () {
                var toplamTaksitSayisi = $('input[class="tahsilatListesi"]:checkbox:checked').length;
                if (toplamTaksitSayisi == 0) {
                    swal("Hata ", "Taksit Seçmediniz.", "warning")
                    return false;
                }
                var toplamOdenen = 0;
                var kismiHaricOdenen = 0;
                parseFloat(toplamOdenen).toFixed(2);
                parseFloat(kismiHaricOdenen).toFixed(2);
                var kismiId = "";
                $('input[class=tahsilatListesi]').each(function (index, element) {
                    if ($(this).is(':checked')) {
                        toplamOdenen = toplamOdenen + parseFloat(String($(this).attr("odenecekTutar")));
                        if ((parseFloat(String($(this).attr("odenecekTutar")).replace(",", "."))) != (parseFloat(String($(this).attr("taksitTutari")).replace(",", ".")))) {
                            kismiId = $(this).attr("id");
                        }
                        else {
                            kismiHaricOdenen = kismiHaricOdenen + parseFloat(String($(this).attr("odenecekTutar")));
                        }
                    }
                });
                toplamOdenen = parseFloat(toplamOdenen).toFixed(2);
                var toplamTaksitMiktari = parseFloat(String($("#_TaksitToplamlari").val()).replace(",", ".")).toFixed(2);
                if (kismiId == "") {
                    if (toplamOdenen != toplamTaksitMiktari) {
                        swal("HATA ", "Ödeme Tutarınızı Kontrol Ediniz.", "warning");
                        return false;
                    }
                }
                else if (kismiId != "") {
                    var kismiTaksitMiktari = 0;
                    kismiTaksitMiktari = parseFloat(String($("#" + kismiId).attr("taksittutari")).replace(",", "."));
                    var toplamKismiDahilMiktar = parseFloat((kismiTaksitMiktari + kismiHaricOdenen)).toFixed(2);
                    if (toplamKismiDahilMiktar != toplamTaksitMiktari) {
                        swal("HATA ", "Ödeme Tutarınızı Kontrol Ediniz.", "warning");
                        return false;
                    }
                }
                // hataları burada verdir. Taksit seçmesi, ödemenin taksit toplamından fazla olması gibi.
                $.get("/Muhasebe/Muhasebe/TopluPoliceTahsilatOdemePartial",
                    function (data) {
                        $("#topluPoliceTahsilatOdeme-modal-div").html(data);
                        $.validator.unobtrusive.parse("#topluPoliceTahsilatOdeme-modal-div");
                        $("#topluPoliceTahsilatOdeme-modal").modal('show');
                    },
                    "html");
            });
            // $("[rel=tooltip]").tooltip();
            ////Tvm listesini Dolduruyor....
            //var tvm = $("#TVMKodu").tvmfinder();
            //tvm.enable();
            $('#TVMKodu_text').val("");
            $('#TVMKodu').val("0");

        });
    </script>
}
<head>
    <title>TopluPoliçeÖdeme</title>
</head>

<div class="row-fluid">
    <div class="span12">
        <div class="portlet box light-grey" style="margin-top: 24px;">
            <div class="portlet-title">
                <div class="caption">
                    <i class="icon-reorder"></i>
                    <span class="hidden-480">Toplu Poliçe Ödeme </span>
                </div>
            </div>
            <div class="portlet-body form">
                @using (Html.BeginForm("TopluPoliceTahsilatOdeme", "Muhasebe", FormMethod.Post, new { @class = "form-horizontal", id = "formTopluPoliceListe", enctype = "multipart/form-data" }))
                {

                    <div class="row-fluid" style="padding-top: 10px;">

                        <div class="span4">
                            <div class="control-group">
                                <div class="span1">
                                    @Html.RadioButtonFor(m => m.MusteriGrupKodu, "MustNo", new { Name = "group1", id = "radioMust" })
                                </div>
                                <label class="control-label">Müşteri Grup Kodu</label>
                                <div class="controls">
                                    @Html.TextBoxFor(m => m.MusteriGrupKodu, new { disabled = "disabled", id = "textMust" })
                                </div>
                            </div>
                            <div class="control-group" id="ikiTarihAraligi" hidden>
                                <div class="control-group">
                                    <div class="span1">
                                    </div>
                                    <label class="control-label">İki Tarih Aralığı</label>
                                    <div class="controls">
                                        @Html.TextBoxFor(s => s.BaslangicGunAy, new { minlength = 5, maxlength = 5, style = "width:20%", placeHolder = "gün.ay" }) &nbsp-&nbsp
                                        @Html.TextBoxFor(s => s.BitisGunAy, new { minlength = 5, maxlength = 5, style = "width:20%", placeHolder = "gün.ay" })
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                    <div class="row-fluid">

                        <div class="span4">
                            <div class="control-group">
                                <div class="span1">
                                    @Html.RadioButtonFor(m => m.TvmUnvani, "Tvm", new { Name = "group1", id = "radioTvm" })
                                </div>
                                <label class="control-label">Satış Kanalı</label>
                                <div class="controls">
                                    @Html.TVMFinderFor(m => m.TVMKodu, Model.TvmUnvani)
                                </div>
                            </div>
                            <div class="control-group" id="ikiTarihAraligi1" hidden>
                                <div class="control-group">
                                    <div class="span1">
                                    </div>
                                    <label class="control-label">İki Tarih Aralığı</label>
                                    <div class="controls">
                                        @Html.TextBoxFor(s => s.BaslangicGunAy1, new { minlength = 5, maxlength = 5, style = "width:20%", placeHolder = "gün.ay" }) &nbsp-&nbsp
                                        @Html.TextBoxFor(s => s.BitisGunAy1, new { minlength = 5, maxlength = 5, style = "width:20%", placeHolder = "gün.ay" })
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>




                    <div class="row-fluid">
                        <div class="span4">
                            <div class="control-group">
                                <div class="span1">
                                    @Html.RadioButtonFor(m => m.TcknVkn, "TcVknNo", new { Name = "group1", id = "radiotcvkn" })
                                </div>
                                <label class="control-label">Sigorta Ettiren TCKN/VKN</label>
                                <div class="controls">
                                    @Html.TextBoxFor(m => m.TcknVkn, new { maxlenght = 11, disabled = "disabled", id = "texttcvkn", @class = "onlynumbers" })
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row-fluid">
                        <div class="span4">
                            <div class="control-group">
                                <div class="span1">
                                    @Html.RadioButtonFor(m => m.Unvan, "Unvan", new { Name = "group1", id = "radiounvan" })
                                </div>
                                <label class="control-label">Sigorta Ettiren Ünvanı</label>
                                <div class="control-group">
                                    <div class="controls radio-custom">
                                        @Html.RadioButtonListFor(m => m.Durum, Model.Durumlar)
                                    </div>
                                </div>
                                <div class="control-group">
                                    <div class="controls sahis" style="display: none;">
                                        @Html.TextBoxFor(m => m.Unvan, new { maxlenght = 50, disabled = "disabled", @tabindex = "1", style = "width:50% !important;margin-right:10px;", @class = "textunvan" })
                                        @Html.TextBoxFor(m => m.UnvanSoyad, new { maxlength = 50, disabled = "disabled", @tabindex = "2", style = "width:35%;", id = "textunvansoyad" })
                                    </div>
                                    <div class="control-group firma" style="display: none;">
                                        <div class="controls">
                                            @Html.TextBoxFor(m => m.UnvanFirma, new { maxlenght = 100, disabled = "disabled", style = "width:65% !important;margin-right:10px;", @class = "textunvanfirma" })
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                    <div class="row-fluid">
                        <div class="span4">
                            <div class="control-group">
                                <div class="span1">
                                </div>
                                <label class="control-label">Dönem: </label>
                                <div class="control-group">
                                    @Html.DropDownListFor(s => s.Donem, Model.Donemler, new { style = "width:125px" })
                                </div>
                            </div>
                        </div>
                    </div>
                    @*<div class="row-fluid">
                            <div class="span2">

                                <div class="control-group">
                                    @*<button style="margin-left:20%" class="btn btn-info " id="SigortaEttirenleriGetir" type="button" data-loading-text="Aranıyor..">Sigorta Ettirenleri Ara</button><br />

                                    <a id="SigortaEttirenleriGetir" class="btn red button-submit" style="margin-left:20%;display: none;" href="javascript:;" data-loading-text="Aranıyor..">Sigorta Ettirenleri Ara <i class="icon-search"></i></a>

                                </div>

                            </div>
                            <div class="span5" style="margin-left:0%">
                                <div class="control-group">
                                    @Html.DropDownListFor(s => s.SigortaEttiren, Model.SigortaEttirenListesi, new { style = "width:50%; display: none;", @class = "SigortaEttirenListesi" }) &nbsp;<span style="color:red;display:none;" id="SigortaEttirenToplamSayisi"></span>
                                </div>
                            </div>
                        </div>*@

                    <div class="row-fluid">

                        <div class="span4">
                        </div>

                        <div class="form-actions">
                            <a href="~/Muhasebe/Muhasebe/TopluPoliceTahsilatOdeme" class="btn ligth-grey">@babonline.Clear</a>
                            <input type="submit" id="searchl" class="btn btn-success" data-loading-text="@babonline.QueryIndicator" value="@babonline.Search" />
                            @*<a id="topluPoliceGetir" href="javascript:void(0)" data-loading-text="@babonline.QueryIndicator" class="btn btn-success">@babonline.Search</a>*@
                        </div>
                    </div>
                }
                @{

                    var OdenmemisPoliceVarMi = false;
                    if (Model.police != null && Model.police.OfflineSigortaEttiren != null)
                    {
                        foreach (var item in Model.police.OfflineSigortaEttiren)
                        {
                            foreach (var odeme in item.PoliceGenel.PoliceOdemePlanis)
                            {
                                foreach (var tahsilat in item.PoliceGenel.PoliceTahsilats)
                                {

                                    if (odeme.PoliceId == tahsilat.PoliceId && odeme.TaksitNo == tahsilat.TaksitNo)
                                    {
                                        if (tahsilat.KalanTaksitTutari != null && tahsilat.KalanTaksitTutari > 0)
                                        {
                                            OdenmemisPoliceVarMi = true;
                                        }
                                    }
                                    if (OdenmemisPoliceVarMi)
                                    {
                                        break;
                                    }
                                }
                                if (OdenmemisPoliceVarMi)
                                {
                                    break;
                                }
                            }
                            if (OdenmemisPoliceVarMi)
                            {
                                break;
                            }
                        }
                    }
                }
                @if (Model.police != null && Model.police.OfflineSigortaEttiren != null && OdenmemisPoliceVarMi)
                {
                    <div class="row-fluid" style="margin-top:2.5%">
                        <div class="span10">
                            <div class="control-group">
                                <div class="control-group">
                                    <div class="controls">
                                        <div class="span2" style="margin-left:30px">
                                            <label style="margin-top:1%">Ödeme Miktarı TL</label>
                                            <input type="text" id="OdenenTutar" class="_odenentutar " odenenMinimum="0,00" value="0,00" style="text-align:right" />

                                            <label style="margin-top:1%">Taksit Toplamları</label>
                                            <input type="text" id="_TaksitToplamlari" class="_TaksitToplamlari " value="0,00" style="text-align:right" readonly="readonly" />


                                            <label style="margin-top:1%">Kalan</label>
                                            <input type="text" id="_Kalan" class="_Kalan" kalanTutar="0,00" value="0,00" style="text-align:right" readonly="readonly" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="row-fluid">

                        <div class="span2" style="text-align:center; margin-top:1%">
                            <a id="TopluPoliceTahsilatOdemeYap" href="javascript:void(0)" data-loading-text="Ödeme Yap" class="btn btn-success">Ödeme Yap</a>
                        </div>
                    </div>

                    <div class="row-fluid" style="margin-top: 20px;">
                        <div class="span12">
                            <div id="table-div" style="overflow-x: auto; margin-top: 15px;">
                                <table class="table table-striped table-bordered table-hover dataTable data-table" id="topluPoliceOdemeDataTable">

                                    @foreach (var item in Model.police.OfflineSigortaEttiren)
                                    {

                                        item.PoliceGenel.PoliceOdemePlanis = item.PoliceGenel.PoliceOdemePlanis.OrderBy(w => w.VadeTarihi).ToList();
                                        decimal ToplamKalanTaksitTutari = 0;
                                        foreach (var odeme in item.PoliceGenel.PoliceOdemePlanis)
                                        {
                                            foreach (var tahsilat in item.PoliceGenel.PoliceTahsilats)
                                            {

                                                if (odeme.PoliceId == tahsilat.PoliceId && odeme.TaksitNo == tahsilat.TaksitNo)
                                                {
                                                    if (tahsilat.KalanTaksitTutari != null)
                                                    {
                                                        decimal kalantaksit = Convert.ToDecimal(tahsilat.KalanTaksitTutari);
                                                        ToplamKalanTaksitTutari += kalantaksit;
                                                    }
                                                }
                                                if (ToplamKalanTaksitTutari > 0)
                                                {
                                                    break;
                                                }
                                            }
                                            if (ToplamKalanTaksitTutari > 0)
                                            {
                                                break;
                                            }
                                        }
                                        if (ToplamKalanTaksitTutari > 0)
                                        {
                                            <thead>
                                                <tr>
                                                    <th style="width: 4%;">@babonline.PolicyNo</th>
                                                    <th style="width: 5%;">@babonline.RenewalNo</th>
                                                    <th style="width: 5%;">@babonline.Suppl </th>
                                                    <th style="width: 6%;">@babonline.Net_Premium</th>
                                                    <th style="width: 6%;">@babonline.Gross_Premium</th>
                                                    <th style="width: 6%;">@babonline.Gross_Premium  Döviz</th>
                                                    <th style="width: 3%;">Para<br />Birimi</th>
                                                    <th style="width: 5%;">Döviz Kuru</th>
                                                    <th style="width: 3%;">@babonline.Branch </th>
                                                    <th style="width: 10%;">Sigorta Ettiren</th>
                                                    <th style="width: 10%;">@babonline.Insured</th>
                                                    <th style="width: 10%;">@babonline.InsuranceCompany</th>
                                                    <th style="width: 3%;">@babonline.Date_Of_the_Establishment</th>
                                                    <th style="width: 3%;">@babonline.PolicyStartDate</th>
                                                    <th style="width: 3%;">@babonline.PolicyFinishDate</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>@item.PoliceGenel.PoliceNumarasi</td>
                                                    <td>@item.PoliceGenel.YenilemeNo </td>
                                                    <td>@item.PoliceGenel.EkNo </td>
                                                    <td style="text-align:right">@item.PoliceGenel.NetPrim </td>
                                                    <td style="text-align:right">@item.PoliceGenel.BrutPrim </td>
                                                    <td style="text-align:right">@item.PoliceGenel.DovizliBrutPrim </td>
                                                    <td style="text-align:center">@item.PoliceGenel.ParaBirimi </td>
                                                    <td>@item.PoliceGenel.DovizKur </td>
                                                    <td>@item.PoliceGenel.BransAdi </td>
                                                    <td>@item.PoliceGenel.PoliceSigortaEttiren.AdiUnvan @item.PoliceGenel.PoliceSigortaEttiren.SoyadiUnvan </td>
                                                    <td>@item.PoliceGenel.PoliceSigortali.AdiUnvan @item.PoliceGenel.PoliceSigortali.SoyadiUnvan </td>
                                                    <td>@item.PoliceGenel.SigortaSirketleri.SirketAdi </td>
                                                    <td>@item.PoliceGenel.TanzimTarihi.Value.ToString("dd.MM.yyyy") </td>
                                                    <td>@item.PoliceGenel.BaslangicTarihi.Value.ToString("dd.MM.yyyy") </td>
                                                    <td>@(item.PoliceGenel.BitisTarihi.Value.ToString("dd.MM.yyyy") != null ? item.PoliceGenel.BitisTarihi.Value.ToString("dd.MM.yyyy") : null)</td>
                                                </tr>
                                                <tr>
                                                    <th class="baslikRow" style="width: 4%; text-align:center"><input policeId="@item.PoliceId" policeNumarasi="@item.PoliceGenel.PoliceNumarasi" type="checkbox" class="tahsilatListesiTopluSecim" />Tümünü<br /> Seç</th>
                                                    <th class="baslikRow" style="width: 5%;">Taksit No</th>
                                                    <th class="baslikRow" style="width:  5%;">Vade Tarihi</th>
                                                    <th class="baslikRow" style="width:  6%;">Kalan Tutarı</th>
                                                    <th class="baslikRow" style="width:  6%;">Taksit Tut. TL</th>
                                                    <th class="baslikRow" style="width:  6%;">Taksit Tut. Döviz</th>
                                                    <th></th>
                                                    <th></th>
                                                    <th></th>
                                                    <th></th>
                                                    <th></th>
                                                    <th></th>
                                                    <th></th>
                                                    <th></th>
                                                    <th></th>

                                                </tr>
                                                @{
                                                    decimal toplamKalanTaksit = 0;
                                                    decimal toplamtaksitTutari = 0;
                                                    decimal toplamtaksitTutariDoviz = 0;
                                                }
                                                @foreach (var odeme in item.PoliceGenel.PoliceOdemePlanis)
                                                {
                                                    foreach (var tahsilat in item.PoliceGenel.PoliceTahsilats)
                                                    {

                                                        if (odeme.PoliceId == tahsilat.PoliceId && odeme.TaksitNo == tahsilat.TaksitNo)
                                                        {
                                                            // policenin taksitlerini yazıyoruz
                                                            <tr>
                                                                @{
                                                                    var kalanOdeme = tahsilat.KalanTaksitTutari.Value;
                                                                }
                                                                @if (kalanOdeme <= 0)
                                                                {
                                                                    <td style="text-align:center"> <label><img src="~/Content/img/yesiltik.png" style="width: 20%" /></label></td>
                                                                }
                                                                else
                                                                {
                                                                    <td style="text-align:center"><input id="@tahsilat.PoliceId-@tahsilat.TaksitNo" taksitPoliceId="@tahsilat.PoliceId" type="checkbox" class="tahsilatListesi" taksitNo="@tahsilat.TaksitNo" taksitTutari="@tahsilat.KalanTaksitTutari" odenecekTutar="@tahsilat.KalanTaksitTutari" policeNumarasi="@item.PoliceGenel.PoliceNumarasi" /></td>

                                                                }
                                                                <td>@tahsilat.TaksitNo</td>
                                                                <td>@tahsilat.TaksitVadeTarihi.ToString("dd.MM.yyyy")</td>
                                                                <td style="text-align:right">@tahsilat.KalanTaksitTutari</td>
                                                                <td style="text-align:right">@tahsilat.TaksitTutari</td>
                                                                @if (odeme.DovizliTaksitTutari != null)
                                                                {
                                                                    <td style="text-align:right">@odeme.DovizliTaksitTutari</td>
                                                                }
                                                                else
                                                                {
                                                                    <td></td>
                                                                }
                                                                @{
                                                                    if (tahsilat.KalanTaksitTutari != null)
                                                                    {
                                                                        decimal kalantaksit = Convert.ToDecimal(tahsilat.KalanTaksitTutari);
                                                                        toplamKalanTaksit += kalantaksit;
                                                                    }
                                                                    if (odeme.DovizliTaksitTutari != null)
                                                                    {
                                                                        decimal taksitTutariDoviz = Convert.ToDecimal(odeme.DovizliTaksitTutari);
                                                                        toplamtaksitTutariDoviz += taksitTutariDoviz;
                                                                    }

                                                                    decimal taksitTutari = Convert.ToDecimal(tahsilat.TaksitTutari);
                                                                    toplamtaksitTutari += taksitTutari;
                                                                }
                                                                <td></td>
                                                                <td></td>
                                                                <td></td>
                                                                <td></td>
                                                                <td></td>
                                                                <td></td>
                                                                <td></td>
                                                                <td></td>
                                                                <td></td>
                                                            </tr>
                                                        }
                                                    }
                                                }
                                                <tr>
                                                    <td><b>Toplam Tutar </b></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td style="text-align:right;"><b>@toplamKalanTaksit</b></td>
                                                    <td style="text-align:right;"><b>@toplamtaksitTutari</b></td>
                                                    @if (toplamtaksitTutariDoviz != 0)
                                                    {
                                                        <td style="text-align:right;"><b>@toplamtaksitTutariDoviz</b></td>
                                                    }
                                                    else
                                                    {
                                                        <td></td>
                                                    }
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>

                                                </tr>
                                            </tbody>
                                        }
                                    }
                                </table>
                            </div>
                        </div>
                    </div>
                }

            </div>
        </div>
    </div>
</div>
@*toplu poliçe tahsilat odeme*@
<div id="topluPoliceTahsilatOdeme-modal-div"></div>
