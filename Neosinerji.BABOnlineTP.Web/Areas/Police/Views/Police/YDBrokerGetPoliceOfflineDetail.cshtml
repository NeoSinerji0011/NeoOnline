@using Neosinerji.BABOnlineTP.Web.Content.Lang
@using Neosinerji.BABOnlineTP.Business.Common
@model  Neosinerji.BABOnlineTP.Business.Police


<head>
    <meta charset="utf-8">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="Expires" content="-1">
    <title>jQuery UI Datepicker - Default functionality</title>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" href="/resources/demos/style.css">
    <link href="~/Content/css/datepicker.css" rel="stylesheet" />
    <link href="~/Content/css/datepicker.min.css" rel="stylesheet" />
    <link href="~/Content/css/daterangepicker.css" rel="stylesheet" />
    <script src="~/Content/js/mask.js" type="text/javascript"></script>
    <script src="~/Content/js/daterangepicker.js"></script>
    <link href="~/Content/css/jquery.gritter.css" rel="stylesheet" type="text/css" />
    <script src="@Url.Content("~/Content/js/jquery.gritter.min.js")" type="text/javascript"></script>
    <link href="~/Content/Angular/css/sweetalert.css" rel="stylesheet" />
    <script src="~/Content/Angular/js/sweetalert.min.js"></script>
    <script src="~/Content/js/autoNumeric.js" type="text/javascript"></script>
</head>
@section HorizontalMenu
{}
@section PageHeader
{}
@section PageScripts
{
    <script>
        var topluTahsilatMi = false;

        function showInfoSweetAlert(title, text = "", showConfirmButton = false, imageUrl = null) {
            swal({
                title: title,
                text: text,
                type: "info",
                imageUrl: imageUrl,
                showCancelButton: false,
                imageWidth: 32,
                imageHeight: 32,
                showConfirmButton: showConfirmButton,
                closeOnConfirm: false,
                allowOutsideClick: false
            });
        }

        $(document).ready(function () {
            $(".autoNumeric-custom").autoNumeric('init', { vMin: '-999999999', vMax: '999999999', mDec: 2, aSep: '.', aDec: ',' });
            // sayfa yüklenirken olması gereken kontroller
            var taliKayitId = $(".1-tahsilat ").attr("talipolice-kayit-kodu");
            var resultSuccess = "";
            var OdeyenCariHesapKodu = "";
            var OdeyenCariHesapAdi = "";
            var OdeyenCariHesapLenght = "";
            var CariHesapAdiVarMi = "";


            var kimlikNo = $("#musteriKimlikNo").val();
            var policeId = $("#GenelBilgiler_PoliceId").val();

            $(".odemeBelgeNoSecimi").parent().css("display", "none");
            $(".odeme-belge-no").parent().css("display", "none");

            var odemeBelgeNolar = $(".odeme-belge-no");

            var tvmKodu = $(".odenen-tutar").first().attr("data-tvm-kodu");

            // Yurtdışı broker ise
            var YurtdisiBrokerMi = false;
            $.ajax({
                url: '/Police/Police/CheckIfYurtdisiBrokerByTVMKodu',
                data: { tvmKodu: tvmKodu },
                async: false,
                success: function (data) {
                    YurtdisiBrokerMi = data === "True";

                    if (YurtdisiBrokerMi) {
                        var sigortaSirketAdi = $("#sigortaSirketAdi").val();
                        var paraBirimi = getParaBirimiKoduByPoliceId(policeId);
                        $(".odenen-tutar").attr("disabled", "disabled");

                        $.each(odemeBelgeNolar, function () {
                            $(this).attr("disabled", true);
                            $(this).attr("value", sigortaSirketAdi);
                            $(this).attr("title", "320." + paraBirimi + "." + kimlikNo);

                        });

                        var cariHesapKodu;
                        $.get("/Police/Police/GetCariHesapByVKN", { vkn: kimlikNo, policeid: policeId }, function (data) {
                            cariHesapKodu = data;
                            $(".odeyenCariHesapclass").attr("title", cariHesapKodu);
                        });

                        //var taksitOdemeTurleri = $(".Taksit-Odeme-Turu");
                        //$.each(taksitOdemeTurleri, function () {
                        //    $(this).val("1");
                        //    $(this).attr("disabled", true);
                        //});
                    }
                }
            });


            function getParaBirimiKoduByPoliceId(policeId) {
                var paraBirimiKodu;
                $.ajax({
                    url: '/Police/Police/GetParaBirimiKoduByPoliceId',
                    data: { policeId: policeId },
                    async: false,
                    success: function (result) {
                        paraBirimiKodu = result;

                    }
                });
                return paraBirimiKodu;
            }


            $.ajax({
                url: '/Police/Police/GetCariHesapByTCKN',
                dataType: 'json',
                data: { Polid: taliKayitId },
                async: false,
                success: function (result) {
                    resultSuccess = result.success;
                    OdeyenCariHesapKodu = result.cariKodu;
                    OdeyenCariHesapAdi = result.cariAdi;
                    OdeyenCariHesapLenght = result.cariKodu.length;
                    CariHesapAdiVarMi = result.CariHesapAdiVarMi;
                }
            });


            $("html").find(".taksitno").each(function (i) {
                var DegisenOdemeTuru = $("#" + (i + 1) + "-taksit-odeme-turu").val();
                if (DegisenOdemeTuru == 2) {

                    $("#" + (i + 1) + "-Odeme-Belge-No").attr("placeholder", "İlk 6 ve son 4 hane.");
                    $("#" + (i + 1) + "-Odeme-Belge-No").mask("999999******9999");
                    $("#" + (i + 1) + "-Odeme-Belge-No").text("reset");
                    $("#" + (i + 1) + "-txtCariHesapSecimi").show();
                    $("#" + (i + 1) + "-ddlCariHesapSecimi").hide();
                }
                else if (DegisenOdemeTuru == 1 || DegisenOdemeTuru == 4 || DegisenOdemeTuru == 5 || DegisenOdemeTuru == 3 || DegisenOdemeTuru == 6 || DegisenOdemeTuru == 7 || DegisenOdemeTuru == 8 || DegisenOdemeTuru == 9 || DegisenOdemeTuru == 11) {
                    var carihesapadi = $("#CariHesapAdi").val();
                    $.ajax({
                        url: '/Police/Police/GetAcenteBankaHesaplari',
                        data: { hesaptipi: DegisenOdemeTuru },
                        dataType: 'json',
                        async: false,
                        success: function (data) {
                            return;
                            if (data.success) {
                                $("#" + (i + 1) + "-optCariHesapSecimi").empty();
                                for (var j = 0; j < data.list.length; j++) {

                                    var item = data.list[j]
                                    var cari = data.carilist[j]
                                    var id = "#" + (i + 1) + "-optCariHesapSecimi";
                                    $("" + id + "").append("<option value='" + item.Value + "' carikodu='" + cari.Value + "' >" + item.Value + " - " + item.Text + "</option>");

                                }
                                if (DegisenOdemeTuru == 5 || DegisenOdemeTuru == 9) {
                                    $("#" + (i + 1) + "odeyenCariHesap").val("");
                                    $("#" + (i + 1) + "odeyenCariHesap").val(data.carilist[0].Value);
                                    $("#" + (i + 1) + "odeyenCariHesap").text(data.carilist[0].Value);
                                }

                            }
                            else {
                                $("#" + (i + 1) + "-optCariHesapSecimi").show();
                                $("#" + (i + 1) + "-txtCariHesapSecimi").hide();
                                $("#" + (i + 1) + "-optCariHesapSecimi").empty();

                            }
                        }
                    });

                    $("#" + (i + 1) + "-txtCariHesapSecimi").hide();
                    $("#" + (i + 1) + "-ddlCariHesapSecimi").show();
                }
                else {
                    $("#" + (i + 1) + "-Odeme-Belge-No").val("");
                    $("#" + (i + 1) + "-Odeme-Belge-No").attr("placeholder", "Ödeme Belge No");
                    $("#" + (i + 1) + "-Odeme-Belge-No").text("reset");
                }

                /////////////// cari hesap
                if (DegisenOdemeTuru == "1" || DegisenOdemeTuru == "2" || DegisenOdemeTuru == "3" || DegisenOdemeTuru == "4" || DegisenOdemeTuru == "6" || DegisenOdemeTuru == "7" || DegisenOdemeTuru == "11") {
                    $("#" + (i + 1) + "odeyenCariHesap").attr("disabled", "disabled");
                    if (resultSuccess && CariHesapAdiVarMi) {
                        //$("#" + (i + 1) + "odeyenCariHesap").val(OdeyenCariHesapKodu + " " + OdeyenCariHesapAdi);
                        $("#" + (i + 1) + "odeyenCariHesap").text(OdeyenCariHesapKodu);
                    }
                    else if (resultSuccess && !CariHesapAdiVarMi) {
                        var carihesapGuncellendiMi = "";
                        swal({
                            title: "Cari Hesap Adınız Eksiktir.",
                            text: " Güncellemek İster Misiniz?\nCari Hesap Adı: " + OdeyenCariHesapAdi + "\nCari Hesap Kodu: " + OdeyenCariHesapKodu,
                            type: "info",
                            showCancelButton: true,
                            closeOnConfirm: false,
                            showLoaderOnConfirm: true
                        }, function () {
                            $.getJSON('/Police/Police/UpdateCariHesap', { cariHesapKodu: OdeyenCariHesapKodu, cariHesapUnvan: OdeyenCariHesapAdi },
                                function (data) {
                                    if (data.success) {
                                        setTimeout(function () {
                                            swal("Cari Hesap Güncellendi!\nCari Hesap Adı: " + OdeyenCariHesapAdi + "\nCari Hesap Kodu: " + OdeyenCariHesapKodu);
                                        }, 3000);
                                        carihesapGuncellendiMi = "true";
                                    }
                                    else {
                                        setTimeout(function () {
                                            swal("Cari Hesap Güncellenemedi!");
                                        }, 3000);
                                        carihesapGuncellendiMi = "false";
                                    }
                                });
                        });
                        if (carihesapGuncellendiMi == "true") {
                            $("#" + (i + 1) + "odeyenCariHesap").val(OdeyenCariHesapKodu + " " + OdeyenCariHesapAdi);
                            $("#" + (i + 1) + "odeyenCariHesap").text(OdeyenCariHesapKodu);
                        }
                        else {
                            $("#" + (i + 1) + "odeyenCariHesap").val(OdeyenCariHesapKodu);
                            $("#" + (i + 1) + "odeyenCariHesap").text(OdeyenCariHesapKodu);
                        }
                    }
                    //soru sorsun ilgili kişinin cari hesabı bulunmamaktadır. Oluşturulmasını ister misiniz ? cari hesab adı- kodu
                    else if (!resultSuccess && !YurtdisiBrokerMi) {
                        if (OdeyenCariHesapLenght == "7") {
                            swal("Hata ", "Cari Hesap Kodu Bulunmamaktadır.\nSigorta Ettirenin TCKN/VKN Bulunmadığı İçin Otomatik Cari Hesap Yaratılamıyor.", "warning");
                        }
                        else {
                            $("#" + (i + 1) + "odeyenCariHesap").val("");
                            $("#" + (i + 1) + "odeyenCariHesap").text("");
                            swal({
                                title: "İlgili Cari Hesap Bulunmamaktadır.\nOluşturmak ister misiniz?",
                                text: "Cari Hesap Adı: " + OdeyenCariHesapAdi + "\nCari Hesap Kodu: " + OdeyenCariHesapKodu,
                                type: "info",
                                showCancelButton: true,
                                closeOnConfirm: false,
                                showLoaderOnConfirm: true
                            }, function () {
                                var cariHesapKodu = OdeyenCariHesapKodu;

                                $.getJSON('/Police/Police/CreateCariHesap', { Polid: taliKayitId, cariHesapKodu: cariHesapKodu },
                                    function (data) {
                                    });
                                setTimeout(function () {
                                    swal("Cari Hesap Adı: " + OdeyenCariHesapAdi + "\nCari Hesap Kodu: " + OdeyenCariHesapKodu + "\nCari Hesap Oluşturuldu!");
                                    $("#" + (i + 1) + "odeyenCariHesap").val(OdeyenCariHesapKodu + " " + OdeyenCariHesapAdi);
                                    $("#" + (i + 1) + "odeyenCariHesap").text(OdeyenCariHesapKodu);
                                }, 3000);
                            });
                        }
                    }
                }

                var OdemeBelgeNo = $("#" + (i + 1) + "-ddlCariHesapSecimi").attr("odemeBelgeNo");
                if (OdemeBelgeNo != "" && OdemeBelgeNo !== undefined) {
                    $("#" + (i + 1) + "-ddlCariHesapSecimi select").val(OdemeBelgeNo);
                    if ($('option:selected', "#" + (i + 1) + "-optCariHesapSecimi").val() == "" || $('option:selected', "#" + (i + 1) + "-optCariHesapSecimi").val() == undefined) {
                        $("#" + (i + 1) + "-ddlCariHesapSecimi select").val($("#" + (i + 1) + "-ddlCariHesapSecimi option:first").val());
                    }
                    odemeTipi = $("#" + (i + 1) + "-taksit-odeme-turu").val()
                    if (odemeTipi == 5 || odemeTipi == 9) {
                        var odeyenCariHesap = $('option:selected', "#" + (i + 1) + "-optCariHesapSecimi").attr("carikodu");
                        $("#" + (i + 1) + "odeyenCariHesap").val(odeyenCariHesap);
                        $("#" + (i + 1) + "odeyenCariHesap").text(odeyenCariHesap);
                    }
                }
                else {
                    $("#" + (i + 1) + "-ddlCariHesapSecimi select").val($("#" + (i + 1) + "-ddlCariHesapSecimi option:first").val());
                    odemeTipi = $("#" + (i + 1) + "-taksit-odeme-turu").val()
                    if (odemeTipi == 5 || odemeTipi == 9) {
                        var odeyenCariHesap = $('option:selected', "#" + (i + 1) + "-optCariHesapSecimi").attr("carikodu");
                        $("#" + (i + 1) + "odeyenCariHesap").val(odeyenCariHesap);
                        $("#" + (i + 1) + "odeyenCariHesap").text(odeyenCariHesap);
                    }
                }
                if (DegisenOdemeTuru == "15") {
                    $("#" + (i + 1) + "-txtCariHesapSecimi").hide();
                    $("#" + (i + 1) + "-ddlCariHesapSecimi").show();
                    $("#" + (i + 1) + "-optCariHesapSecimi").empty();
                    $("#" + (i + 1) + "-optCariHesapSecimi").show();
                    $("#" + (i + 1) + "-txtCariHesapSecimi").val("");
                    $("#" + (i + 1) + "-txtCariHesapSecimi").hide();
                    $("#" + (i + 1) + "odeyenCariHesap").val("");
                }
                // kismi ödeme yapılmış ise ödeme türünü değiştirmemesi için yazıldı.
                //var taksitTutari = $("#" + (i + 1) + "-taksitTutari").val();
                //var kalanTaksitTutari = $("#" + (i + 1) + "-kalanOdemeTutari").val();
                //if (taksitTutari != kalanTaksitTutari) {
                //    $("#" + (i + 1) + "-taksit-odeme-turu").prop("disabled", true);
                //    $("#" + (i + 1) + "-Odeme-Belge-No").prop("disabled", true);
                //    $("#" + (i + 1) + "-optCariHesapSecimi").prop("disabled", true);
                //}
                ///////
            });

        });
        $(document).ready(function () {
            var divSayisi = 0;
            $("html").find(".Datepicker").each(function (i) {
                $(this).datepicker();
            });

            $('.odemeBelgeNoSecimi').change(function () {
                var taksitsay = $(this).attr("taksitsay");
                odemeTipi = $("#" + taksitsay + "-taksit-odeme-turu").val()
                if (odemeTipi == 5 || odemeTipi == 9) {
                    var odeyenCariHesap = $('option:selected', "#" + (taksitsay) + "-optCariHesapSecimi").attr("carikodu");
                    $("#" + (taksitsay) + "odeyenCariHesap").val(odeyenCariHesap);
                    $("#" + (taksitsay) + "odeyenCariHesap").text(odeyenCariHesap);
                }
            });

            $('.Taksit-Odeme-Turu').change(function () {
                //debugger;
                var taksitsay = $(this).attr("taksitsay");
                var DegisenOdemeTuru = $(this).val();
                if (DegisenOdemeTuru == 11) {
                    DegisenOdemeTuru = 1;
                }

                if (DegisenOdemeTuru == 2) {
                    $("#" + (taksitsay) + "-Odeme-Belge-No").attr("placeholder", "İlk 6 ve son 4 hane.");
                    // $("#" + (taksitsay) + "-Odeme-Belge-No").prop('maxlength', '10');
                    $("#" + (taksitsay) + "-Odeme-Belge-No").mask("999999******9999");
                    $("#" + (taksitsay) + "-Odeme-Belge-No").text("reset");
                    $("#" + (taksitsay) + "-txtCariHesapSecimi").show();
                    $("#" + (taksitsay) + "-ddlCariHesapSecimi").hide();
                }
                else if (DegisenOdemeTuru == 1 || DegisenOdemeTuru == 4 || DegisenOdemeTuru == 5 || DegisenOdemeTuru == 3 || DegisenOdemeTuru == 6 || DegisenOdemeTuru == 7 || DegisenOdemeTuru == 8 || DegisenOdemeTuru == 9 || DegisenOdemeTuru == 11) {
                    var carihesapadi = $("#CariHesapAdi").val();
                    $.ajax({
                        url: '/Police/Police/GetAcenteBankaHesaplari',
                        data: { hesaptipi: DegisenOdemeTuru },
                        dataType: 'json',
                        async: false,
                        success: function (data) {
                            if (data.success) {

                                $("#" + (taksitsay) + "-optCariHesapSecimi").show();
                                $("#" + (taksitsay) + "-txtCariHesapSecimi").hide();
                                $("#" + (taksitsay) + "-optCariHesapSecimi").empty();


                                for (var j = 0; j < data.list.length; j++) {
                                    var item = data.list[j]
                                    var cari = data.carilist[j]
                                    var id = "#" + (taksitsay) + "-optCariHesapSecimi";
                                    $("" + id + "").append("<option value='" + item.Value + "' carikodu='" + cari.Value + "' >" + item.Value + " - " + item.Text + "</option>");
                                }


                                if (DegisenOdemeTuru == 5 || DegisenOdemeTuru == 9) {
                                    $("#" + (taksitsay) + "odeyenCariHesap").val("");
                                    $("#" + (taksitsay) + "odeyenCariHesap").val(data.carilist[0].Value);
                                    $("#" + (taksitsay) + "odeyenCariHesap").text(data.carilist[0].Value);
                                }
                                /////////
                                //ilgili para birimlerinin listesini ayarlar
                                var odemeparabirimi = $("#" + taksitsay + "-ddlCariHesapSecimi").attr("odemeparabirimikodu")
                                var rmoptionlist = [];
                                $("#" + taksitsay + "-optCariHesapSecimi" + " > option").each(function (i, j) {
                                    var chesap = this.getAttribute("carikodu").split(".")[1];
                                    // console.log(chesap + "<------------" + odemeparabirimi)
                                    if (chesap == odemeparabirimi) {
                                        // console.log(j)
                                        rmoptionlist.push(j);
                                    }
                                });
                                $("#" + taksitsay + "-optCariHesapSecimi").empty();
                                var tempselectoption = $("#" + taksitsay + "-optCariHesapSecimi")[0]
                                rmoptionlist.forEach(function (i, j) {
                                    // tempindex = tempselectoption.querySelector('option[value="' + i.value + '"]').index
                                    tempselectoption.add(i)
                                })
                                //ödeme yapılan hesabı seçtirir
                                var borcluHesap = $("#" + taksitsay + "-ddlCariHesapSecimi").attr("odemebelgeno")
                                if (borcluHesap) {
                                    $("#" + taksitsay + "-optCariHesapSecimi").val(borcluHesap)
                                    $("#" + taksitsay + "-optCariHesapSecimi").css("pointer-events", "none");
                                }


                                /////////
                            }
                            else {

                                $("#" + (taksitsay) + "-optCariHesapSecimi").hide();
                                $("#" + (taksitsay) + "-txtCariHesapSecimi").show();
                                $("#" + (taksitsay) + "-txtCariHesapSecimi").val();

                            }

                        }
                    });

                    $("#" + (taksitsay) + "-txtCariHesapSecimi").hide();
                    $("#" + (taksitsay) + "-ddlCariHesapSecimi").show();
                }
                else {
                    $("#" + (taksitsay) + "-Odeme-Belge-No").val("");
                    $("#" + (taksitsay) + "-Odeme-Belge-No").attr("placeholder", "Ödeme Belge No");
                    $("#" + (taksitsay) + "-Odeme-Belge-No").text("reset");
                }

                /////////////// cari hesap
                if (DegisenOdemeTuru == "1" || DegisenOdemeTuru == "2" || DegisenOdemeTuru == "3" || DegisenOdemeTuru == "4" || DegisenOdemeTuru == "6" || DegisenOdemeTuru == "7" || DegisenOdemeTuru == "11") {
                    $("#" + (taksitsay) + "odeyenCariHesap").attr("disabled", "disabled");

                    var taliKayitId = $("." + (taksitsay) + "-tahsilat ").attr("talipolice-kayit-kodu");
                    $.ajax({
                        url: '/Police/Police/GetCariHesapByTCKN',
                        dataType: 'json',
                        data: { Polid: taliKayitId },
                        async: false,
                        success: function (result) {
                            var tvmTipi = $("#tvmTipiInput").val();
                            if (result.success && result.CariHesapAdiVarMi) {
                                $("#" + (taksitsay) + "odeyenCariHesap").val(result.cariKodu + " " + result.cariAdi);
                                $("#" + (taksitsay) + "odeyenCariHesap").text(result.cariKodu);
                            }
                            else if (result.success && !result.CariHesapAdiVarMi) {
                                $("#" + (taksitsay) + "odeyenCariHesap").val(result.cariKodu);
                                $("#" + (taksitsay) + "odeyenCariHesap").text(result.cariKodu);
                            }
                            //soru sorsun ilgili kişinin cari hesabı bulunmamaktadır. Oluşturulmasını ister misiniz ? cari hesab adı- kodu
                            else if (!result.success && !YurtdisiBrokerMi) {
                                swal({
                                    title: "İlgili Cari Hesap Bulunmamaktadır.\nOluşturmak ister misiniz?",
                                    text: "Cari Hesap Adı: " + result.cariAdi + "\nCari Hesap Kodu: " + result.cariKodu,
                                    type: "info",
                                    showCancelButton: true,
                                    closeOnConfirm: false,
                                    showLoaderOnConfirm: true
                                }, function () {
                                    var cariHesapKodu = result.cariKodu;

                                    $.getJSON('/Police/Police/CreateCariHesap', { Polid: taliKayitId, cariHesapKodu: cariHesapKodu },
                                        function (data) {
                                        });
                                    setTimeout(function () {
                                        swal("Cari Hesap Adı: " + result.cariAdi + "\nCari Hesap Kodu: " + result.cariKodu + "\nCari Hesap Oluşturuldu!");
                                    }, 3000);
                                });
                                $("#" + (taksitsay) + "odeyenCariHesap").val(result.cariKodu + " " + result.cariAdi);
                                $("#" + (taksitsay) + "odeyenCariHesap").text(result.cariKodu);
                            }

                        }
                    });
                }
                if (DegisenOdemeTuru == "15") {
                    $("#" + (taksitsay) + "-txtCariHesapSecimi").hide();
                    $("#" + (taksitsay) + "-ddlCariHesapSecimi").show();
                    $("#" + (taksitsay) + "-optCariHesapSecimi").show();
                    $("#" + (taksitsay) + "-txtCariHesapSecimi").val("");
                    $("#" + (taksitsay) + "-txtCariHesapSecimi").hide();
                    $("#" + (taksitsay) + "-optCariHesapSecimi").empty();
                    $("#" + (taksitsay) + "odeyenCariHesap").val("");
                }

            });

            ////////
            $("td[id*=ddlCariHesapSecimi]").each(function () {

                //if ($(this).attr("odemebelgeno") != null)
                {
                    var taksitno = $(this).attr("id").split('-')[0]
                    var el = "#" + taksitno + "-taksit-odeme-turu"
                    $(el).val(3)
                    $(el).attr("readonly")
                    setTimeout(function () {
                        $(el).trigger("change");
                        $(el).css("pointer-events", "none");
                    }, 1000);
                }
            });
            ///////

            $("#save-police-tahsilat").live("click", function () {
                debugger;
                $(this).button("loading");
                swal({ title: "Lütfen bekleyiniz.", text: "Ödeniyor...", type: "info", showConfirmButton: false });
                var taliKayitId = parseInt($(this).attr("talipolice-kayit-kodu"));
                var odenenTutar = "";
                var taksitsayisi = parseInt($(this).attr("taksitsayisi"));
                var taksitTutarlar = "";
                var tarih = "";
                var belgeno = "";
                var TaksitOdemeTuru = "";
                var kalanOdemeler = 0;
                var kalanOdemelerString = "";
                var acenteKrediKarti = ""
                var dekontEvrakNo = "";

                odenenTutar = $("#" + (taksitsayisi) + "-Odenen-Tutar").val().split(".").join("");
                var odenenTutarF = parseFloat(odenenTutar.replace(/\s/g, "").replace(",", "."));
                tarih = $("#" + (taksitsayisi) + "-datepicker").val();
                var belgeno = $("#" + (taksitsayisi) + "-Odeme-Belge-No").val();
                TaksitOdemeTuru = $("#" + (taksitsayisi) + "-taksit-odeme-turu").val();
                kalanOdemeler = $("#" + (taksitsayisi) + "-kalanOdemeTutari").val().split(".").join("");
                var kalanOdemelerF = parseFloat(kalanOdemeler.replace(/\s/g, "").replace(",", "."));
                kalanOdemelerString = $("#" + (taksitsayisi) + "-kalanOdemeTutari").val();
                taksitTutarlar = $("#" + (taksitsayisi) + "-taksitTutari").val().split(".").join("");
                var taksitTutarlarF = parseFloat(taksitTutarlar.replace(/\s/g, "").replace(",", "."));
                acenteKrediKarti = $("#" + (taksitsayisi) + "-optCariHesapSecimi").val();
                dekontEvrakNo = $("#" + (taksitsayisi) + "-dekontEvrakNo").val();
                $('#' + (taksitsayisi) + 'odeyenCariHesap').removeAttr("disabled");
                var odeyenCariHesapKodu = $('#' + (taksitsayisi) + 'odeyenCariHesap').val();
                $('#' + (taksitsayisi) + 'odeyenCariHesap').attr("disabled", "disabled");
                if (taksitTutarlarF < 0) {
                    $(this).button("reset");
                    swal("Uyarı ", "Bu İptal Ekidir.\nÖdeme Yapamazsınız.", "warning")
                    return false;
                }
                if (kalanOdemelerString == "0,00") {
                    $(this).button("reset");
                    swal("Uyarı ", "Ödeme İşlemi Tamamlanmıştır.", "warning")
                    return false;
                }
                if (tarih == "") {
                    $(this).button("reset");
                    swal("Hata ", "Lütfen Ödeme Belge Tarih Alanını Doldurunuz.", "warning")
                    return false;
                }
                if (odeyenCariHesapKodu == "") {
                    $(this).button("reset");
                    swal("Hata ", "Lütfen Ödeyen Cari Hesabı Alanını Doldurunuz.", "warning")
                    return false;
                }
                if ((dekontEvrakNo == "") && (TaksitOdemeTuru == 3 || TaksitOdemeTuru == 4 || TaksitOdemeTuru == 7)) {
                    $(this).button("reset");
                    swal("Hata ", "Lütfen Dekont/Evrak No Alanını Doldurunuz.", "warning")
                    return false;
                }
                if (belgeno == "" && TaksitOdemeTuru == "2") {
                    $(this).button("reset");
                    swal("Hata ", "Lütfen Ödeme Belge No Alanını Doldurunuz.", "warning")
                    return false;
                }
                if (acenteKrediKarti == "" && TaksitOdemeTuru != "2") {
                    $(this).button("reset");
                    swal("Hata ", "Lütfen Borçlu Hesabı Seçiniz.", "warning")
                    return false;
                }
                if (odenenTutar == "") {
                    $(this).button("reset");
                    swal("Hata ", "Lütfen Ödencek Tutar Alanını Doldurunuz.", "warning")
                    return false;
                }
                if (TaksitOdemeTuru == "") {
                    $(this).button("reset");
                    swal("Hata ", "Lütfen Taksit Ödeme Türü Alanını Doldurunuz.", "warning")
                    return false;
                }
                if (TaksitOdemeTuru == "Lütfen Seçiniz..") {
                    $(this).button("reset");
                    swal("Hata ", "Lütfen Taksit Ödeme Türü Alanını Doldurunuz.", "warning")
                    return false;
                }
                if (odenenTutarF == "0") {
                    $(this).button("reset");
                    swal("Uyarı ", "Geçerli Bir Değer Giriniz.", "warning")
                    return false;
                }

                if (kalanOdemelerString == "") {
                    if (odenenTutarF > taksitTutarlarF) {
                        $(this).button("reset");
                        swal("Hata ", "Ödenecek tutar alanını fazla girdiniz", "warning")
                        return false;
                    }
                }
                else {
                    if (odenenTutarF > kalanOdemelerF) {
                        $(this).button("reset");
                        swal("Hata ", "Ödenecek tutar alanını fazla girdiniz", "warning")
                        return false;
                    }
                }
                var carihesapVarmi = "false";
                var carihesapyokAdi = "";
                var carihesapyokCariKodu = "";
                if (TaksitOdemeTuru == "1" || TaksitOdemeTuru == "2" || TaksitOdemeTuru == "3" || TaksitOdemeTuru == "4" || TaksitOdemeTuru == "6" || TaksitOdemeTuru == "7" || TaksitOdemeTuru == "11") {
                    $.ajax({
                        url: '/Police/Police/GetCariHesapByTCKN',
                        dataType: 'json',
                        data: { Polid: taliKayitId },
                        async: false,
                        success: function (result) {
                            if (!result.success) {
                                carihesapVarmi = "true";
                                carihesapyokAdi = result.cariAdi;
                                carihesapyokCariKodu = result.cariKodu;
                            }

                        }
                    });
                }
                if (carihesapVarmi == "true") {
                    $(this).button("reset");
                    swal("Ödeme Yapılamadı!", "İlgili Cari Hesap Bulunmamaktadır.\nCari Hesap Adı: " + carihesapyokAdi + "\nCari Hesap Kodu: " + carihesapyokCariKodu, "error")
                    return false;
                }
                $.ajax({
                    timeout: 10000000,
                    method: "post",
                    url: "/Police/Police/GetYurtdisiBrokerPoliceOfflineDetail",
                    data: { Polid: taliKayitId, taksitNo: taksitsayisi, OdenenTutar: odenenTutar, BelgeNo: belgeno, BelgeTarihi: tarih, OdemeTuru: TaksitOdemeTuru, AcenteKrediKarti: acenteKrediKarti, odeyenCariHesapKodu: odeyenCariHesapKodu, dekontEvrakNo: dekontEvrakNo, topluTahsilatMi: topluTahsilatMi },

                    success: function (mesaj) {
                        if (mesaj.mesaj == "true") {
                            $(this).button("reset");
                            //swal( {"Başarılı!", "İşleminiz Gerçekleşmiştir!", "success");
                            //location.reload(true);
                            swal({
                                title: "Başarılı",
                                text: "Ödeme işleminiz gerçekleşmiştir!",
                                type: "success",
                                showCancelButton: false,
                                confirmButtonColor: "#DD6B55",
                                confirmButtonText: "Tamam",
                                closeOnConfirm: false
                            },
                                function (isConfirm) {
                                    if (isConfirm) {
                                        location.reload(true);
                                    }
                                });
                        }
                        else if (!mesaj.Muhasebe) {
                            $(this).button("reset");
                            swal({
                                title: "Başarısız",
                                text: "Poliçe Cariye Aktarılmamıştır.\nTahsilat Girişi Yapamazsınız.",
                                type: "warning",
                                showCancelButton: false,
                                confirmButtonColor: "#DD6B55",
                                confirmButtonText: "Tamam",
                                closeOnConfirm: false
                            },
                                function (isConfirm) {
                                    if (isConfirm) {
                                        location.reload(true);
                                    }
                                });
                        }
                        else {
                            $(this).button("reset");
                            swal({
                                title: "Başarısız",
                                text: "Ödeme işleminiz Yapılamadı! \nGirdiğiniz bilgileri kontrol ediniz.",
                                type: "warning",
                                showCancelButton: false,
                                confirmButtonColor: "#DD6B55",
                                confirmButtonText: "Tamam",
                                closeOnConfirm: false
                            },
                                function (isConfirm) {
                                    if (isConfirm) {
                                        location.reload(true);
                                    }
                                });
                        }
                    },

                });


            });

            $("#iptal-police-tahsilat").live("click", function () {
                if ($(this).text().trim() == "İptal") {
                    $(this).button("loading");
                    var taliKayitId = $(this).attr("talipolice-kayit-kodu");
                    var odenenTutar = "";
                    var taksitsayisi = $(this).attr("taksitsayisi");
                    var taksitTutarlar = "";
                    var tarih = "";
                    var belgeno = "";
                    var TaksitOdemeTuru = "";
                    var kalanOdemeler = 0;
                    var kalanOdemelerString = "";
                    var taksitTutarlarF = 0;
                    var dekontEvrakNo = "";
                    dekontEvrakNo = $("#" + (taksitsayisi) + "-dekontEvrakNo").val();
                    odenenTutar = $("#" + (taksitsayisi) + "toplamOdenenTutar").text();
                    var odenenTutarF = parseFloat(odenenTutar.replace(/\s/g, "").replace(",", "."));
                    tarih = $("#" + (taksitsayisi) + "-datepicker").val();
                    var belgeno = $("#" + (taksitsayisi) + "-Odeme-Belge-No").val();
                    TaksitOdemeTuru = $("#" + (taksitsayisi) + "-taksit-odeme-turu").val();
                    kalanOdemeler = $("#" + (taksitsayisi) + "-kalanOdemeTutari").val();
                    var kalanOdemelerF = parseFloat(kalanOdemeler.replace(/\s/g, "").replace(",", "."));
                    kalanOdemelerString = $("#" + (taksitsayisi) + "-kalanOdemeTutari").val();
                    taksitTutarlar = $("#" + (taksitsayisi) + "-taksitTutari").val();
                    taksitTutarlarF = parseFloat(taksitTutarlar.replace(/\s/g, "").replace(",", "."));
                    var acenteKrediKarti = $("#" + (taksitsayisi) + "-optCariHesapSecimi").val();
                    $('#' + (taksitsayisi) + 'odeyenCariHesap').removeAttr("disabled");
                    var odeyenCariHesapKodu = $('#' + (taksitsayisi) + 'odeyenCariHesap').text();
                    $('#' + (taksitsayisi) + 'odeyenCariHesap').attr("disabled", "disabled");
                    if (taksitTutarlarF < 0) {
                        $(this).button("reset");
                        swal("Uyarı ", "Bu İptal Ekidir.\nİptal Yapamazsınız.", "warning")
                        return false;
                    }
                    if (tarih == "") {
                        $(this).button("reset");
                        swal("Hata ", "Lütfen Ödeme Belge Tarih Alanını Doldurunuz.", "warning")
                        return false;
                    }
                    if (TaksitOdemeTuru == "") {
                        $(this).button("reset");
                        swal("Hata ", "Lütfen Taksit Ödeme Türü Alanını Doldurunuz.", "warning")
                        return false;
                    }
                    if (kalanOdemeler == taksitTutarlar) {
                        $(this).button("reset");
                        swal("Hata ", "Ödeme işlemi gerçekleşmeden İptal işlemini gerçekleştiremezsiniz.", "warning")
                        return false;
                    }

                    swal({
                        title: "İptal etmek istiyor musunuz?",
                        type: "warning",
                        showCancelButton: true,
                        closeOnConfirm: false,
                        showLoaderOnConfirm: true
                    }, function () {
                        showInfoSweetAlert("Lütfen bekleyiniz.", "Ödeme iptal ediliyor...", false);
                        $.ajax({
                            timeout: 10000000,
                            method: "post",
                            url: "/Police/Police/GetPoliceTahsilatIptali",
                            data: { Polid: taliKayitId, taksitNo: taksitsayisi, odenenTutar: odenenTutar, BelgeNo: belgeno, BelgeTarihi: tarih, OdemeTuru: TaksitOdemeTuru, acenteKrediKarti: acenteKrediKarti, odeyenCariHesapKodu: odeyenCariHesapKodu, taksitTutarlarF: taksitTutarlarF, dekontEvrakNo: dekontEvrakNo },

                            success: function (mesaj) {
                                if (mesaj.mesaj == "true") {
                                    // swal( {"Başarılı!", "İşleminiz Gerçekleşmiştir!", "success");
                                    // location.reload(true);
                                    $(this).button("reset");
                                    swal({
                                        title: "Başarılı",
                                        text: "İptal işleminiz gerçekleşmiştir!",
                                        type: "success",
                                        showCancelButton: false,
                                        confirmButtonColor: "#DD6B55",
                                        confirmButtonText: "Tamam",
                                        closeOnConfirm: false
                                    },
                                        function (isConfirm) {
                                            if (isConfirm) {
                                                location.reload(true);
                                            }
                                        });
                                }
                                else if (mesaj.uyari) {
                                    $(this).button("reset");
                                    swal({
                                        title: "Mesaj",
                                        text: mesaj.mesaj,
                                        type: "warning",
                                        showCancelButton: false,
                                        confirmButtonColor: "#DD6B55",
                                        confirmButtonText: "Tamam",
                                        closeOnConfirm: false
                                    },
                                        function (isConfirm) {
                                            if (isConfirm) {
                                                location.reload(true);
                                            }
                                        });
                                }
                                else {
                                    $(this).button("reset");
                                    swal({
                                        title: "Başarısız",
                                        text: "İptal işleminiz Yapılamadı!\nGirdiğiniz bilgileri kontrol ediniz.",
                                        type: "warning",
                                        showCancelButton: false,
                                        confirmButtonColor: "#DD6B55",
                                        confirmButtonText: "Tamam",
                                        closeOnConfirm: false
                                    },
                                        function (isConfirm) {
                                            if (isConfirm) {
                                                location.reload(true);
                                            }
                                        });
                                }
                            },

                        });
                    });
                }

            });

            //toplu tahsilat iptali
            $("#topluTahsilatIptali").click(function () {
                var arr = [];
                $('input.taksitno:checkbox:checked').each(function () {
                    arr.push($(this).val());
                });

                var carihesap = [];
                var odemebelgenoSecimiListesi = $(".odemeBelgeNoSecimi");
                odemebelgenoSecimiListesi.each(function () {
                    carihesap.push($('option:selected', this).val());
                });

                var policeId = $(this).attr("toplutahsilatIptali-kayit-kodu");

                swal({
                    title: "Toplu Tahsilat İptalini Onaylıyor Musunuz?",
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#DD6B55",
                    confirmButtonText: "Onayla",
                    closeOnConfirm: false,
                    closeOnCancel: false
                },
                    function (isConfirm) {
                        if (isConfirm) {
                            //$("#adres-sorgu-progress").show();
                            $.ajax({
                                timeout: 10000000,
                                method: "post",
                                url: "/Police/Police/TopluTahsilatIptali",
                                data: { lessonType: arr, policeId: policeId, odemebelgenoSecimiListesi: carihesap },
                                success: function (response) {
                                    $("#odemetipi-guncelle").button("reset");
                                    // $("#adres-sorgu-progress").hide();
                                },
                            });

                            swal({
                                title: "Toplu Tahsilat İptali işleminiz gerçekleşmiştir!",
                                type: "success",
                                showCancelButton: false,
                                confirmButtonColor: "#DD6B55",
                                confirmButtonText: "OK",
                                closeOnConfirm: false,
                                closeOnCancel: false
                            },
                                function (isConfirm) {
                                    if (isConfirm) {
                                        location.reload(true);
                                    }
                                });
                        } else {
                            swal("Bilgi", "Toplu Tahsilat İptal İşlemi Yapılmadı.", "warning");
                            $("#odemetipi-guncelle").button("reset");
                        }
                    });

            });

            $("#kimlik-guncelle").click(function () {
                var policeId = $("#GenelBilgiler_PoliceId").val();
                $.get("/Police/Police/KimlikGuncelle",
                    { PoliceId: policeId },
                    function (data) {
                        $("#kimlik-guncelle-modal-div").html(data);
                        $.validator.unobtrusive.parse("#kimlik-guncelle-modal-div");
                        $("#kimlikGuncelle-modal").modal('show');
                    },
                    "html");
            });

            $("#kimlik-guncelle-btn").live("click", function () {
                var kimlikNo = $("#kimlikNo").val();
                if (kimlikNo != null && kimlikNo != "") {
                    var contents = $("#kimlik-guncelle-form").serialize();
                    $.ajax(
                        {
                            type: "POST",
                            url: "/Police/Police/KimlikGuncelle",
                            data: contents,
                            success: function (data) {
                                if (data.Success == "True") {
                                    window.location.href = "/Police/Police/GetYurtdisiBrokerPoliceOfflineDetail/" + data.PolId;
                                }
                                else {
                                    swal("HATA! Kimlik bilgileri güncellenirken bir hata oluştu.", "error");
                                }
                            },
                            error: function () {
                            }
                        });
                }
                else {
                    swal("HATA! Lütfen bilgileri eksiksiz giriniz.", "error");
                }
            });

            $("#odemetipi-guncelle").click(function () {
                $(this).button("loading");
                var policeId = $("#GenelBilgiler_PoliceId").val();
                $.get("/Police/Police/OdemeTipiGuncelle",
                    { PoliceId: policeId },
                    function (data) {
                        $("#odemetipi-guncelle-modal-div").html(data);
                        $.validator.unobtrusive.parse("#odemetipi-guncelle-modal-div");
                        $("#odemetipiGuncelle-modal").modal('show');

                    },
                    "html");
                $("#odemetipi-guncelle").button("reset");
            });

            $("#odemetipi-guncelle-btn").live("click", function () {
                var policeId = $("#GenelBilgiler_PoliceId").val();
                var OdemeTipi = $("#OdemeTipi").val();
                if (OdemeTipi != null && OdemeTipi != "") {
                    var contents = $("#odemetipi-guncelle-form").serialize();
                    $(this).button("loading");
                    $.ajax(
                        {
                            type: "POST",
                            url: "/Police/Police/OdemeTipiGuncelle",
                            data: { OdemeTipi: OdemeTipi, policeId: policeId },
                            success: function (data) {
                                if (data.Success == "True") {
                                    window.location.href = "/Police/Police/GetYurtdisiBrokerPoliceOfflineDetail/" + data.PolId;
                                }
                                else {
                                    swal("HATA! Ödeme tipi güncellenirken bir hata oluştu.", "error");
                                }
                            },
                            error: function () {
                            }
                        });
                }
                else {
                    swal("HATA! Lütfen bilgileri eksiksiz giriniz.", "error");
                }
                $(this).button("load");
            });

            $("#topluTahsilatOdeme").click(function () {
                $("html").find(".odenen-tutar").each(function (i) {
                    divSayisi = i + 1;
                });
                for (var i = 0; i < divSayisi; i++) {
                    taksitTutarlar = $("#" + (i + 1) + "-taksitTutari").val();
                    var taksitTutarlarF = parseFloat(taksitTutarlar.replace(/\s/g, "").replace(",", "."));
                    if (taksitTutarlarF < 0) {
                        swal("Uyarı ", "Bu İptal Ekidir.\nÖdeme Yapamazsınız.", "warning")
                        return false;
                    }
                }

                $("#topluTahsilatOdeme").button("loading");
                var policeId = $("#GenelBilgiler_PoliceId").val();
                $.get("/Police/Police/YurtdisiBrokerTopluTahsilatKapama",
                    { PoliceId: policeId },
                    function (data) {
                        $("#topluTahsilatOdeme-modal-div").html(data);
                        $.validator.unobtrusive.parse("#topluTahsilatOdeme-modal-div");
                        $("#topluTahsilatOdeme-modal").modal('show');
                        $(this).button("reset");

                    },
                    "html");
            });

            $(".odemeBelgeNoSecimi").parent().css("display", "none");
            $(".odeme-belge-no").parent().css("display", "block");



        });

    </script>
}
@{
    var kimlikGuncellemeYetkisi = false;
    if (String.IsNullOrEmpty(Model.GenelBilgiler.PoliceSigortali.KimlikNo) && String.IsNullOrEmpty(Model.GenelBilgiler.PoliceSigortali.VergiKimlikNo) &&
        String.IsNullOrEmpty(Model.GenelBilgiler.PoliceSigortaEttiren.KimlikNo) && String.IsNullOrEmpty(Model.GenelBilgiler.PoliceSigortaEttiren.KimlikNo))
    {
        kimlikGuncellemeYetkisi = true;
    }
}

<form id="tahsilat-form" class="form-horizontal">
    @Html.HiddenFor(m => m.GenelBilgiler.PoliceId)
    @Html.HiddenFor(m => m.GenelBilgiler.TVMKodu)
    @{ Html.EnableClientValidation(true); }
    @Html.AntiForgeryToken()
    <div class="" style="margin-top: 24px;">
        <div class="portlet-title">
            <div class="caption"><i class="icon-reorder"></i>@babonline.Policy_Details</div>
            <div class="tools">
                <a href="javascript:;" class="collapse"></a>
            </div>
        </div>
        <div class="portlet-body">
            <div class="control-group">
                <div class="form-section-header">
                    <h3 class="form-section">@babonline.General_Information</h3>
                    @if (kimlikGuncellemeYetkisi)
                    {
                        <div class="span3" style="float: right">
                            <label><a id="kimlik-guncelle" href="javascript:void(0)" data-toggle="modal" class="btn btn-success">@babonline.Update</a></label>
                            <label style="color:red;">@babonline.TCKN_VKN_YKN (@babonline.Update)</label>
                        </div>
                    }
                    <div class="span12">
                        <div class="span4">
                            <label class="control-label"><b>@babonline.PolicyNo :</b>  @Model.GenelBilgiler.PoliceNumarasi</label>
                        </div>
                        <div class="span4">
                            <label class="control-label"><b>@babonline.Addendum :</b>  @Model.GenelBilgiler.EkNo</label>
                        </div>
                        <div class="span4">
                            <label class="control-label"><b>@babonline.RenewalNo :</b>  @Model.GenelBilgiler.YenilemeNo</label>
                        </div>
                    </div>
                    <div class="span12">
                        <div class="span4">
                            <label class="control-label"><b>Slip No:</b>  @ViewBag.SlipNo</label>
                        </div>

                    </div>
                </div>
                <div class="span12">
                    <div class="span4">
                        <label style="color:#2d59ea" class=""><b>@babonline.Date_of_Issuance :</b>@Model.GenelBilgiler.TanzimTarihi.Value.ToShortDateString()</label>
                    </div>
                    <div class="span4">
                        <label style="color:#2d59ea" class=""><b>@babonline.Inception_Date :</b>@Model.GenelBilgiler.BaslangicTarihi.Value.ToShortDateString()</label>
                    </div>
                    <div class="span4">
                        @if (!String.IsNullOrEmpty(@Model.GenelBilgiler.BitisTarihi.ToString()))
                        {
                            <label style="color:#2d59ea" class=""><b>@babonline.ExpiryDate :</b>@Model.GenelBilgiler.BitisTarihi.Value.ToShortDateString()</label>

                        }
                    </div>
                </div>
                <div class="span12">
                    <div class="span4">
                        <label style="color:#2d59ea" class=""><b>@babonline.InsuranceCompany :</b>  @Model.GenelBilgiler.SigortaSirketleri.SirketAdi </label>
                    </div>

                    <div class="span4">
                        <label style="color:#2d59ea" class=""><b>@babonline.SalesChannel :</b>  @ViewBag.SatisKanali</label>
                    </div>
                    <div class="span4">
                        <label style="color:#2d59ea" class=""><b>@babonline.Out_Sales_Channel :</b>  @ViewBag.DisKaynakUnvani</label>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="control-group">
        <div class="form-section-header">
            <h3 class="form-section">@babonline.Insured</h3>
            @if (!String.IsNullOrEmpty(@Model.GenelBilgiler.PoliceSigortali.KimlikNo))
            {
                <div class="span3">
                    <label class="control-label"><b>@babonline.IdentificationNumber :</b>  @Model.GenelBilgiler.PoliceSigortali.KimlikNo</label>
                </div>
                <div class="span3">
                    <label class="control-label"><b>@babonline.Name :</b>  @Model.GenelBilgiler.PoliceSigortali.AdiUnvan  @Model.GenelBilgiler.PoliceSigortali.SoyadiUnvan</label>
                </div>
                <div class="span3">
                    <label class="control-label"><b>@babonline.Address :</b>  @Model.GenelBilgiler.PoliceSigortali.Adres</label>
                </div>
            }
            else if (!String.IsNullOrEmpty(@Model.GenelBilgiler.PoliceSigortali.VergiKimlikNo))
            {
                <div class="span3">
                    <label class="control-label"><b>@babonline.Tax_Identification_Number :</b> @Model.GenelBilgiler.PoliceSigortali.VergiKimlikNo</label>
                </div>
                <div class="span3">
                    <label class="control-label"><b>@babonline.Name :</b>  @Model.GenelBilgiler.PoliceSigortali.AdiUnvan   @Model.GenelBilgiler.PoliceSigortali.SoyadiUnvan</label>
                </div>
                <div class="span3">
                    <label class="control-label"><b>@babonline.Address :</b>  @Model.GenelBilgiler.PoliceSigortali.Adres</label>
                </div>
            }
            else
            {
                <div class="span3">
                    <label class="control-label"><b>@babonline.IdentificationNumber :</b> @Model.GenelBilgiler.PoliceSigortali.KimlikNo</label>
                </div>
                <div class="span3">
                    <label class="control-label"><b>@babonline.Name :</b>  @Model.GenelBilgiler.PoliceSigortali.AdiUnvan   @Model.GenelBilgiler.PoliceSigortali.SoyadiUnvan</label>
                </div>
                <div class="span3">
                    <label class="control-label"><b>@babonline.Address :</b>  @Model.GenelBilgiler.PoliceSigortali.Adres</label>
                </div>
            }

        </div>
    </div>

    @if (Model.GenelBilgiler.PoliceSigortali.KimlikNo != null)
    {
        <input id="musteriKimlikNo" value="@Model.GenelBilgiler.PoliceSigortali.KimlikNo" type="hidden">
    }
    else
    {
        <input id="musteriKimlikNo" value="@Model.GenelBilgiler.PoliceSigortali.VergiKimlikNo" type="hidden">
    }




    <div class="control-group">
        <div class="form-section-header">
            <h3 class="form-section">@babonline.Policy_Holder</h3>

            @if (!String.IsNullOrEmpty(@Model.GenelBilgiler.PoliceSigortaEttiren.KimlikNo))
            {
                <div class="span3">
                    <label class="control-label" id="sigortaEttirenTc"><b>@babonline.IdentificationNumber :</b> @Model.GenelBilgiler.PoliceSigortaEttiren.KimlikNo</label>
                </div>
                <div class="span3">
                    <label class="control-label" id="sigortaEttirenAdi"><b>@babonline.Name :</b>  @Model.GenelBilgiler.PoliceSigortaEttiren.AdiUnvan   @Model.GenelBilgiler.PoliceSigortaEttiren.SoyadiUnvan</label>
                </div>
                <div class="span3">
                    <label class="control-label" id="sigortaEttirenAdres"><b>@babonline.Address :</b>  @Model.GenelBilgiler.PoliceSigortaEttiren.Adres</label>

                </div>
            }
            else if (!String.IsNullOrEmpty(@Model.GenelBilgiler.PoliceSigortaEttiren.VergiKimlikNo))
            {
                <div class="span3">
                    <label class="control-label" id="sigortaEttirenTc"><b>@babonline.Tax_Identification_Number :</b> @Model.GenelBilgiler.PoliceSigortaEttiren.VergiKimlikNo</label>
                </div>
                <div class="span3">
                    <label class="control-label" id="sigortaEttirenAdi"><b>@babonline.Name :</b>  @Model.GenelBilgiler.PoliceSigortaEttiren.AdiUnvan  @Model.GenelBilgiler.PoliceSigortaEttiren.SoyadiUnvan</label>
                </div>
                <div class="span3">
                    <label class="control-label" id="sigortaEttirenAdres"><b>@babonline.Address :</b>  @Model.GenelBilgiler.PoliceSigortaEttiren.Adres</label>

                </div>
            }
            else
            {
                <div class="span3">
                    <label class="control-label" id="sigortaEttirenTc"><b>@babonline.IdentificationNumber :</b>  @Model.GenelBilgiler.PoliceSigortaEttiren.KimlikNo</label>
                </div>
                <div class="span3">
                    <label class="control-label" id="sigortaEttirenAdi"><b>@babonline.Name :</b>  @Model.GenelBilgiler.PoliceSigortaEttiren.AdiUnvan  @Model.GenelBilgiler.PoliceSigortaEttiren.SoyadiUnvan</label>
                </div>
                <div class="span3">
                    <label class="control-label" id="sigortaEttirenAdres"><b>@babonline.Address :</b>  @Model.GenelBilgiler.PoliceSigortaEttiren.Adres</label>

                </div>
            }
        </div>
    </div>
    <div class="control-group">
        <div class="form-section-header">

            @if (@Model.GenelBilgiler.BransKodu == 1 || @Model.GenelBilgiler.BransKodu == 2)
            {
                <h3 class="form-section">@babonline.VehicleInfo</h3>

                <div class="span3">
                    <label class="control-label"><b>@babonline.Plate :</b> @Model.GenelBilgiler.PoliceArac.PlakaKodu @Model.GenelBilgiler.PoliceArac.PlakaNo  </label>
                </div>
                <div class="span3">
                    <label class="control-label"><b>@babonline.VehicleModel :</b> @Model.GenelBilgiler.PoliceArac.Model</label>
                </div>
                <div class="span3">
                    <label class="control-label"><b>@babonline.VehicleBrand :</b> @Model.GenelBilgiler.PoliceArac.Marka</label>
                </div>
                <div class="span3">
                    <label class="control-label"><b>@babonline.Vehicle_Type :</b> @Model.GenelBilgiler.PoliceArac.AracinTipiAciklama @Model.GenelBilgiler.PoliceArac.AracinTipiAciklama2 </label>
                </div>
                <div class="span3">
                    <label class="control-label"><b>@babonline.VehicleValue :</b> @Model.GenelBilgiler.PoliceArac.AracDeger</label>
                </div>
                <div class="span3">
                    <label class="control-label"><b>@babonline.ChassisNo :</b>  @Model.GenelBilgiler.PoliceArac.SasiNo</label>
                </div>
                <div class="span3">
                    <label class="control-label"><b>@babonline.EngineNo :</b>  @Model.GenelBilgiler.PoliceArac.MotorNo</label>
                </div>
                <div class="span3">
                    <label class="control-label"><b>@babonline.VehicleBrand @babonline.Description :</b>  @Model.GenelBilgiler.PoliceArac.MarkaAciklama</label>
                </div>
                <div class="span3">
                    <label class="control-label"><b>@babonline.Vehicle_Type @babonline.Description :</b>  @Model.GenelBilgiler.PoliceArac.AracinTipiAciklama</label>
                </div>
                <div class="span3">
                    <label class="control-label"><b>@babonline.Vehicle_Type @babonline.Description 2 :</b>  @Model.GenelBilgiler.PoliceArac.AracinTipiAciklama2</label>
                </div>
                <div class="span3">
                    <label class="control-label"><b>@babonline.Registration_Serial_No :</b>  @Model.GenelBilgiler.PoliceArac.TescilSeriNo</label>
                </div>
                <div class="span3">
                    <label class="control-label"><b>@babonline.Registration_Serial_Code :</b>  @Model.GenelBilgiler.PoliceArac.TescilSeriKod</label>
                </div>
                <div class="span3">
                    <label class="control-label"><b>@babonline.VehicleUsageType :</b>  @Model.GenelBilgiler.PoliceArac.KullanimTarzi</label>
                </div>
                <div class="span3">
                    <label class="control-label"><b>@babonline.VehicleUsage :</b>  @Model.GenelBilgiler.PoliceArac.KullanimSekli</label>
                    @{
                        var trafikCikisTarihi = @Model.GenelBilgiler.PoliceArac.TrafikCikisTarihi.HasValue ? @Model.GenelBilgiler.PoliceArac.TrafikCikisTarihi.Value.ToString("dd/MM/yyyy") : "";
                        var trafikTescilTarihi = @Model.GenelBilgiler.PoliceArac.TrafikTescilTarihi.HasValue ? Model.GenelBilgiler.PoliceArac.TrafikTescilTarihi.Value.ToString("dd/MM/yyyy") : "";
                        var tramerBelgeTarihi = @Model.GenelBilgiler.PoliceArac.TramerBelgeTarihi.HasValue ? @Model.GenelBilgiler.PoliceArac.TramerBelgeTarihi.Value.ToString("dd/MM/yyyy") : "";

                    }
                </div>
                <div class="span3">
                    <label class="control-label"><b>@babonline.TrafficDate :</b> @trafikCikisTarihi</label>
                </div>
                <div class="span3">
                    <label class="control-label"><b>@babonline.LicenceDate :</b>@trafikTescilTarihi </label>
                </div>
                <div class="span3">
                    <label class="control-label"><b>@babonline.Tramer_Document_No :</b>  @Model.GenelBilgiler.PoliceArac.TramerBelgeNo</label>
                </div>
                <div class="span3">
                    <label class="control-label"><b>@babonline.Tramer_Document_Date :</b>@tramerBelgeTarihi </label>
                </div>
                <div class="span3">
                    <label class="control-label"><b>@babonline.Vehicle_Type @babonline.Code :</b>  @Model.GenelBilgiler.PoliceArac.AracinTipiKodu</label>
                </div>
                <div class="span3">
                    <label class="control-label"><b>@babonline.Vehicle_Type @babonline.Code 2 :</b>  @Model.GenelBilgiler.PoliceArac.AracinTipiKodu2</label>
                </div>
                <div class="span3">
                    <label class="control-label"><b>@babonline.ASBISNo :</b>  @Model.GenelBilgiler.PoliceArac.AsbisNo</label>
                </div>
                <div class="span3">
                    <label class="control-label"><b>@babonline.Number_of_Seats :</b>  @Model.GenelBilgiler.PoliceArac.KoltukSayisi</label>
                </div>
            }

            else
            {
                if (Model.GenelBilgiler.BransKodu != 4)
                {
                    <h3 class="form-section">@babonline.RiskInfo</h3>
                    <div class="span3">

                        <label class="control-label"><b>@babonline.Risk @babonline.Address :</b> @Model.GenelBilgiler.PoliceRizikoAdresi.Adres</label>

                    </div>
                    <div class="span3">
                        <label class="control-label"><b>@babonline.Risk @babonline.BuildingCost :</b> @Model.GenelBilgiler.PoliceRizikoAdresi.BinaBedel</label>

                    </div>
                }

            }
        </div>
    </div>
    <div class="form-section">
        <h3><b>@babonline.Type_of_Payment </b></h3>
        <div class="span6">
            <div class="span4" style="margin-top:5%">
                @{ int sayac = 0;
                    if (Model.GenelBilgiler.PoliceOdemePlanis.Count > 0)
                    {
                        foreach (var item in Model.GenelBilgiler.PoliceOdemePlanis)
                        {

                            if (sayac == 0)
                            {
                                switch (@item.OdemeTipi)
                                {
                                    case 1:
                                        <label class="control-label"><b>@babonline.Type_of_Payment: </b> @babonline.Cash</label>
                                        break;
                                    case 2:
                                        <label class="control-label"><b>@babonline.Type_of_Payment: </b> @babonline.Customer @babonline.Credit_Card</label>
                                        break;
                                    case 3:
                                        <label class="control-label"><b>@babonline.Type_of_Payment: </b> @babonline.Bank_Transfer</label>
                                        break;
                                    case 4:
                                        <label class="control-label"><b>@babonline.Type_of_Payment: </b> @babonline.Check</label>
                                        break;
                                    case 5:
                                        <label class="control-label"><b>@babonline.Type_of_Payment: </b> @babonline.Agency @babonline.Credit_Card</label>
                                        break;
                                    case 6:
                                        <label class="control-label"><b>@babonline.Type_of_Payment: </b> @babonline.AgencyPosAccount</label>
                                        break;
                                    case 7:
                                        <label class="control-label"><b>@babonline.Type_of_Payment: </b> @babonline.Bond</label>
                                        break;
                                    case 8:
                                        <label class="control-label"><b>@babonline.Type_of_Payment: </b> @babonline.Bank_Account</label>
                                        break;
                                    case 9:
                                        <label class="control-label"><b>@babonline.Type_of_Payment: </b> @babonline.AgencyIndividualCCard</label>
                                        break;
                                    case 11:
                                        <label class="control-label"><b>@babonline.Type_of_Payment: </b> @babonline.GoodsOrServicesProcurement</label>
                                        break;
                                    default:
                                        <label class="control-label"><b>@babonline.Type_of_Payment: </b></label>
                                        break;
                                }
                                sayac++;
                            }
                        }
                    }
                    else
                    {
                        <label class="control-label"><b>@babonline.Type_of_Payment:</b> </label>
                    }

                }

            </div>
            <div class="span3" style="margin-top:5%">
                <label><a id="odemetipi-guncelle" href="javascript:void(0)" data-toggle="modal" data-loading-text="@babonline.Updating" data-load-text="@babonline.Update" class="btn btn-success">@babonline.Update</a></label>
                <label style="color:red;"></label>
            </div>
        </div>
    </div>

    <div class="control-group">
        <div class="form-section-header">
            <h3 class="form-section" style="margin-top:auto;">@babonline.PolicyCollectionPaymentInfo</h3>
            @{
                var OdenenTaksitVarMi = true;
                decimal? kalanTaksitTutari = 0;
                var odemeTipleriAyniMi = true;
                var odemeBelgeNolariAyniMi = true;
                var odemeBelgeNoOnceki = "";
                var odemeTipiOnceki = -1;
                foreach (var item in Model.GenelBilgiler.PoliceTahsilats)
                {
                    if (item.OdenenTutar != 0)
                    {
                        OdenenTaksitVarMi = false;
                    }
                    kalanTaksitTutari += item.KalanTaksitTutari;

                    if (odemeTipiOnceki != item.OdemTipi && odemeTipiOnceki != -1)
                    {
                        odemeTipleriAyniMi = false;
                        odemeTipiOnceki = item.OdemTipi;
                    }
                    else
                    {
                        odemeTipleriAyniMi = true;
                        odemeTipiOnceki = item.OdemTipi;
                    }
                    if (odemeBelgeNoOnceki != item.OdemeBelgeNo && odemeBelgeNoOnceki != "")
                    {
                        odemeBelgeNolariAyniMi = false;
                        odemeBelgeNoOnceki = item.OdemeBelgeNo;
                    }
                    else
                    {
                        odemeBelgeNolariAyniMi = true;
                        odemeBelgeNoOnceki = item.OdemeBelgeNo;
                    }

                }
            }


            @if (Model.GenelBilgiler.PoliceOdemePlanis.Count > 0 && OdenenTaksitVarMi)
            {
                <div style="margin-left: 3%;" id="Hide/Show işlemi için">
                    <label class="gunKapadurumu">@babonline.MultiCollectionClosing</label>
                    <a href="javascript:void(0)" toplutahsilat-kayit-kodu="@Model.GenelBilgiler.PoliceId" id="topluTahsilatOdeme" class="btn btn-success gunKapadurumu" type="submit" data-loading-text="@babonline.Closing" style="background-color:#1d943b  !important;">@babonline.CollectionClosing</a>
                </div>

            }
            <div class="span8" style="">
                @if (Model.GenelBilgiler.OdemeSekli == 1)
                {
                    <label class="control-label"><b>@babonline.Payment_Method:</b> @babonline.SinglePayment</label>
                }
                else
                {
                    <label class="control-label"><b>@babonline.Payment_Method:</b> @babonline.Installment @*Taksit*@</label>
                }
                <label class="control-label"><b>@babonline.NumberOfInstallments:</b> @Model.GenelBilgiler.PoliceOdemePlanis.Count</label>
                @if (Model.GenelBilgiler.ParaBirimi != "TL")
                {
                    <label class="control-label"><b>@babonline.Currency_Exchange:</b> @Model.GenelBilgiler.DovizKur</label>
                }
                @*<span>Brokerlar için çalısan view</span>*@
                <table class="table table-striped table-bordered table-hover dataTable data-table">

                    <tr>
                        <th style="width: 10px; text-align: center">@babonline.InstallmentNo</th>
                        <th style="width: 10px; text-align: center">@babonline.DueDate</th>
                        <th style="width: 15px; text-align: center">@babonline.Currency</th>
                        <th style="width: 5px; text-align: center">@babonline.Installment_Amount TL</th>
                        <th style="width: 5px; text-align: center">@babonline.Installment_Amount @babonline.ForeignCurrency</th>
                        <th style="width: 20px; text-align: center">@babonline.PaymentDocumentDate</th>
                        <th style="width: 10px; text-align: center">@babonline.Receipt /<br />@babonline.Document No</th>
                        <th style="width: 15px; text-align: center">@babonline.Type_of_Payment</th>
                        <th style="width: 15px; text-align: center">@babonline.Debit_Account @*Borçlu Hesap*@</th>
                        <th style="width: 15px; text-align: center">@babonline.Paying_Account</th>
                        <th style="width: 5px; text-align: center">@babonline.Payment_Amount</th>ss
                        <th colspan="2" style="width: 10px; text-align: center">@babonline.Collection</th>
                        <th style="width: 5px; text-align: center">@babonline.Remaining_Balance</th>
                        <th style="width: 15px; text-align: center">@babonline.Total_Payment</th>
                    </tr>
                    <tbody>
                        @if (Model.GenelBilgiler.PoliceOdemePlanis.Count > 0)
                        {
                            Model.GenelBilgiler.PoliceOdemePlanis = Model.GenelBilgiler.PoliceOdemePlanis.OrderBy(w => w.VadeTarihi).ToList();
                            string toplamKalanOdeme = "";
                            string toplamOdenecekTutar = "";
                            decimal toplamKalanTaksitTutari = 0;
                            var odenen_sayac = 0;
                            decimal toplamOdenenTutar = 0;
                            decimal toplamOdenenTutarDoviz = 0;

                            foreach (var item in Model.GenelBilgiler.PoliceOdemePlanis)
                            {
                                odenen_sayac++;
                                var kalanOdeme = "";
                                var tahsilatCount = Model.GenelBilgiler.PoliceTahsilats.Count();
                                var odemeBelgeTarihi = "";
                                var odemeBelgeNo = "";
                                var dekontEvrakNo = "";
                                var odemeTuru = item.OdemeTipi;
                                string odenenTutar = "";
                                var odenecekTutar = "";
                                odenecekTutar = item.TaksitTutari.HasValue ? item.TaksitTutari.Value.ToString() : "";
                                <tr>
                                    <td style="text-align: center" class="taksitno">
                                        @item.TaksitNo
                                    </td>
                                    @if (@item.VadeTarihi.HasValue)
                                    {
                                        <td style="text-align: center" id="@(odenen_sayac)-taksitVadeTarihi">  @item.VadeTarihi.Value.ToString("dd/MM/yyyy")</td>
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                    <td style="text-align: center">@item.PoliceGenel.ParaBirimi </td>


                                    @if (item.PoliceGenel.ParaBirimi == "TL")
                                    {
                                        <td style="text-align: center; text-align: right !important;">
                                            <input type="text" class="autoNumeric-custom" disabled="disabled" id="@(odenen_sayac)-taksitTutari" style="width:100px;text-align:right !important;" value="@item.TaksitTutari" />
                                        </td>
                                        <td></td>

                                    }
                                    else
                                    {
                                        <td style="text-align: center; text-align: right !important;">
                                            <input type="text" class="autoNumeric-custom" disabled="disabled" id="@(odenen_sayac)-taksitTutari" style="width:100px;text-align:right !important;" value="@item.TaksitTutari" />
                                        </td>
                                        <td style="text-align: center; text-align: right !important;">
                                            <input type="text" class="autoNumeric-custom" disabled="disabled" id="@(odenen_sayac)-taksitTutariDovizli" style="width:100px;text-align:right !important;" value="@item.DovizliTaksitTutari" />
                                        </td>
                                    }

                                    @foreach (var policeTahsilat in Model.GenelBilgiler.PoliceTahsilats)
                                    {
                                        if (item.PoliceId == policeTahsilat.PoliceId && item.TaksitNo == policeTahsilat.TaksitNo)
                                        {
                                            odemeBelgeTarihi = policeTahsilat.OdemeBelgeTarihi.HasValue ? policeTahsilat.OdemeBelgeTarihi.Value.ToShortDateString() : "";
                                            odemeBelgeNo = policeTahsilat.OdemeBelgeNo;
                                            odemeTuru = Convert.ToByte(policeTahsilat.OdemTipi);

                                            if (Model.GenelBilgiler.ParaBirimi != "TL")
                                            {
                                                //kalanOdeme = (item.DovizliTaksitTutari - policeTahsilat.OdenenTutar).ToString();
                                                if (policeTahsilat.KalanTaksitTutari == 0)
                                                {
                                                    kalanOdeme = "0,00";
                                                    odenecekTutar = "0,00";
                                                }
                                                else
                                                {
                                                    kalanOdeme = (item.DovizliTaksitTutari).ToString();
                                                    odenecekTutar = (item.DovizliTaksitTutari).ToString();
                                                }
                                            }
                                            else
                                            {
                                                kalanOdeme = (policeTahsilat.TaksitTutari - policeTahsilat.OdenenTutar).ToString();
                                                odenecekTutar = (policeTahsilat.TaksitTutari - policeTahsilat.OdenenTutar).ToString();
                                            }


                                            toplamKalanTaksitTutari += (policeTahsilat.TaksitTutari - policeTahsilat.OdenenTutar);
                                            odenenTutar = policeTahsilat.OdenenTutar.ToString();
                                            if (Model.GenelBilgiler.ParaBirimi != "TL")
                                            {
                                                if (policeTahsilat.KalanTaksitTutari == 0)
                                                {
                                                    odenenTutar = item.DovizliTaksitTutari.ToString();
                                                    toplamOdenenTutar += item.DovizliTaksitTutari.Value;
                                                }
                                                else
                                                {
                                                    odenenTutar = "0";
                                                    toplamOdenenTutar += 0;
                                                }

                                            }
                                            else
                                            {
                                                toplamOdenenTutar += policeTahsilat.OdenenTutar;
                                            }

                                            dekontEvrakNo = policeTahsilat.Dekont_EvrakNo;
                                        }
                                    }

                                    @if (Model.GenelBilgiler.PoliceTahsilats.Count > 0)
                                    {
                                        if (Model.GenelBilgiler.ParaBirimi != "TL")
                                        {
                                            toplamOdenecekTutar += item.DovizliTaksitTutari.HasValue ? item.DovizliTaksitTutari.Value : 0;
                                        }
                                        else
                                        {
                                            toplamOdenecekTutar += item.TaksitTutari.HasValue ? item.TaksitTutari.Value : 0;
                                        }
                                    }
                                    @if (odenenTutar != "0,00")
                                    {

                                        <td style="text-align: center">
                                            <input type="text" id="@(odenen_sayac)-datepicker" class="Datepicker" style="width:90px" placeholder="@babonline.Date" value="@odemeBelgeTarihi">
                                        </td>
                                        <td style="text-align: center">
                                            <input type="text" id="@(odenen_sayac)-dekontEvrakNo" class="DekontEvrakNo" placeholder="" required value="@dekontEvrakNo" style="width:100px;" />
                                        </td>
                                    }
                                    else
                                    {
                                        <td style="text-align: center">
                                            <input type="text" id="@(odenen_sayac)-datepicker" class="Datepicker" style="width:90px" placeholder="@babonline.Date" value="@odemeBelgeTarihi">
                                        </td>
                                        <td style="text-align: center">
                                            <input type="text" id="@(odenen_sayac)-dekontEvrakNo" class="DekontEvrakNo" placeholder="" required value="" style="width:100px;" />
                                        </td>
                                    }

                                    @{
                                        List<SelectListItem> hesaptips = new List<SelectListItem>();
                                        hesaptips.AddRange(new SelectListItem[] {
                                                                                                                                                                                                                                                new SelectListItem() { Value = "15", Text = babonline.PleaseSelect },                                                                                                                               new SelectListItem() { Value = "1", Text = babonline.Cash },
                                            new SelectListItem() { Value = "2", Text = babonline.Customer+" "+@babonline.Credit_Card },
                                            new SelectListItem() { Value = "3", Text = babonline.Bank_Transfer },
                                            new SelectListItem() { Value = "4", Text = babonline.Check },
                                            new SelectListItem() { Value = "7", Text = babonline.Bond },
                                            new SelectListItem() { Value = "5", Text = babonline.Agency+" "+babonline.Credit_Card },
                                            new SelectListItem() { Value = "6", Text = babonline.AgencyPosAccount },
                                            new SelectListItem() { Value = "9", Text = babonline.AgencyIndividualCCard },
                                            new SelectListItem() { Value = "11", Text = babonline.GoodsOrServicesProcurement },
                                            //new SelectListItem() { Value = "8", Text = babonline.Bank_Account },
                                            });
                                        if (odenenTutar == "0,00")
                                        {
                                            odemeTuru = 15;
                                        }
                                        var HesapTipleri = new SelectList(hesaptips, "Value", "Text", odemeTuru);
                                    }
                                    <td style="text-align: center">
                                        @Html.DropDownListFor(m => odemeTuru, HesapTipleri, new { style = "width:182px;", @class = "Taksit-Odeme-Turu", @id = odenen_sayac + "-" + "taksit-odeme-turu", @taksitsay = item.TaksitNo })
                                    </td>
                                    <td id="@(odenen_sayac)-ddlCariHesapSecimi" odemeParaBirimiKodu="@ViewBag.ParaBirimKodu" odemeBelgeNo="@odemeBelgeNo" hidden>
                                        <select id="@(odenen_sayac)-optCariHesapSecimi" taksitsay="@item.TaksitNo" class="odemeBelgeNoSecimi" style="width:170px;"></select>


                                    </td>

                                    <input id="sigortaSirketAdi" type="hidden" value="@item.PoliceGenel.SigortaSirketleri.SirketAdi" />

                                    <td id="@(odenen_sayac)-txtCariHesapSecimi">
                                        <input type="text" id="@(odenen_sayac)-Odeme-Belge-No" class="odeme-belge-no" placeholder="@babonline.FirstSixAndLastFourDigits" required style="width:158px;" />
                                    </td>
                                    <td>
                                        <input type="text" id="@(odenen_sayac)odeyenCariHesap" class="odeyenCariHesapclass" taksitsay="@item.TaksitNo" disabled="disabled" style="width:185px" value="@item.PoliceGenel.PoliceSigortali.AdiUnvan" />
                                    </td>

                                    <input id="tvmTipiInput" type="hidden" value="@item.PoliceGenel.TVMDetay.Tipi" />

                                    <td style="text-align: right !important">
                                        <input type="text" id="@(odenen_sayac)-Odenen-Tutar" class="autoNumeric-custom odenen-tutar" data-tvm-kodu="@item.PoliceGenel.TVMKodu" style="text-align:right !important;width:100px" placeholder="Tutar" required value="@odenecekTutar" />
                                    </td>
                                    @if (@kalanOdeme == "0,00")
                                    {
                                        <td>
                                            <label>@babonline.Payment_Completed@*Ödendi*@<img src="~/Content/img/yesiltik.png" style="width: 57%" /></label>
                                        </td>
                                        <td>
                                            <button talipolice-kayit-kodu="@Model.GenelBilgiler.PoliceSigortali.PoliceId" taksitsayisi="@item.TaksitNo" type="button" data-loading-text="@babonline.Canceling" class="btn btn-danger @(odenen_sayac)-tahsilat " id="iptal-police-tahsilat">@babonline.Cancel</button>
                                        </td>
                                    }
                                    else
                                    {
                                        <td style="width: 15%;">
                                            <button talipolice-kayit-kodu="@Model.GenelBilgiler.PoliceSigortali.PoliceId" taksitsayisi="@item.TaksitNo" type="button" data-loading-text="@babonline.Being_Paid.." class="btn btn-success @(odenen_sayac)-tahsilat " id="save-police-tahsilat">@babonline.Pay</button>
                                        </td>
                                        <td style="width: 15%;">
                                            <button talipolice-kayit-kodu="@Model.GenelBilgiler.PoliceSigortali.PoliceId" taksitsayisi="@item.TaksitNo" type="button" data-loading-text="@babonline.Canceling" class="btn btn-danger @(odenen_sayac)-tahsilat " id="iptal-police-tahsilat">@babonline.Cancel</button>
                                        </td>
                                    }
                                    <td style="text-align: center;">
                                        @if (kalanOdeme == "" && item.TaksitTutari.HasValue)
                                        {
                                            kalanOdeme = item.TaksitTutari.Value.ToString();
                                        }
                                        <input type="text" class="autoNumeric-custom" disabled="disabled" id="@(odenen_sayac)-kalanOdemeTutari" style="font-family: 'Adobe Gothic Std'; text-align:right !important; width:100px;" value="@kalanOdeme" />
                                    </td>

                                    <td style="text-align: right">
                                        <label class="label label-success" style="color: white; font-family: 'Adobe Gothic Std'; font-size: 14px;" id="@(odenen_sayac)toplamOdenenTutar">@odenenTutar </label>
                                    </td>
                                </tr>
                                if (Model.GenelBilgiler.ParaBirimi != "TL")
                                {

                                    toplamOdenecekTutar = Math.Abs(item.PoliceGenel.DovizliBrutPrim.Value - toplamOdenenTutar).ToString();

                                }
                                else
                                {
                                    toplamOdenecekTutar = Math.Abs(item.PoliceGenel.BrutPrim.Value - toplamOdenenTutar).ToString();
                                }

                            }
                            if (toplamKalanTaksitTutari == 0)
                            {
                                toplamKalanOdeme = "";

                            }
                            else
                            {
                                toplamKalanOdeme = toplamKalanTaksitTutari.ToString();
                            }

                            <tr>
                                <td><span style="font-family: 'Adobe Gothic Std'">@babonline.Total:</span></td>
                                <td></td>
                                <td></td>
                                <td style="text-align: right"><span style="font-family: 'Adobe Gothic Std'">@Math.Abs(Model.GenelBilgiler.BrutPrim.Value).ToString("N")</span></td>
                                <td style="text-align: right">
                                    <span style="font-family: 'Adobe Gothic Std'">
                                        @if (Model.GenelBilgiler.ParaBirimi != "TL")
                                        {
                                            @Math.Abs(Model.GenelBilgiler.DovizliBrutPrim.Value).ToString("N");
                                        }


                                    </span>
                                </td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td style="text-align: right"><span style="font-family: 'Adobe Gothic Std'; text-align: right !important">@Convert.ToDecimal(toplamOdenecekTutar).ToString("N")</span></td>
                                <td></td>
                                <td></td>
                                <td style="text-align: right"><span style="font-family: 'Adobe Gothic Std'; text-align: right !important" class="label label-important">@Convert.ToDecimal(toplamOdenecekTutar).ToString("N") </span></td>
                                <td style="text-align: right"><span style="font-family: 'Adobe Gothic Std'; color: white; text-align: right !important; font-size: 14px;" class="label label-success ">@toplamOdenenTutar.ToString("N")</span></td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</form>


@*kimlik güncelleme*@
<div id="kimlik-guncelle-modal-div"></div>
@*odeme tipi güncelleme*@
<div id="odemetipi-guncelle-modal-div"></div>
@*toplu tahsilat odeme*@
<div id="topluTahsilatOdeme-modal-div"></div>